<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head/>
  <body><p class="calibre_2">value. You expect to introduce some errors in this step. The trick is to work out which </p>
    <p class="calibre_2">parameters have the most impact on the result, and concentrate on getting them about </p>
    <p class="calibre_2">right. Typically, parameters whose values are added into a result are less significant than </p>
    <p class="calibre_2">those that are multiplied or divided. Doubling a line speed may double the amount of data </p>
    <p class="calibre_2">received in an hour, while adding a 5 ms transit delay will have no noticeable effect. </p>
    <p class="calibre_2">You should have a justifiable way of calculating these critical parameters. For the queuing </p>
    <p class="calibre_2">example, you might want to measure the actual transaction arrival rate of the existing </p>
    <p class="calibre_2">system, or find a similar system to measure. Similarly, you could measure the current time </p>
    <p class="calibre_2">taken to serve a request, or come up with an estimate using the techniques described in </p>
    <p class="calibre_2">this section. In fact, you'll often find yourself basing an estimate on other subestimates. </p>
    <p class="calibre_2">This is where your largest errors will creep in. </p>
    <p class="calibre_2">
      <span class="bold">Calculate the Answers</span>
    </p>
    <p class="calibre_2">Only in the simplest of cases will an estimate have a single answer. You might be happy to </p>
    <p class="calibre_2">say "I can walk five cross-town blocks in 15 minutes." However, as the systems get more </p>
    <p class="calibre_2">complex, you'll want to hedge your answers. Run multiple calculations, varying the values </p>
    <p class="calibre_2">of the critical parameters, until you work out which ones really drive the model. A </p>
    <p class="calibre_2">spreadsheet can be a big help. Then couch your answer in terms of these parameters. </p>
    <p class="calibre_2">"The response time is roughly three quarters of a second if the system has a SCSI bus and </p>
    <p class="calibre_2">64MB memory, and one second with 48MB memory." (Notice how "three quarters of a </p>
    <p class="calibre_2">second" conveys a different feeling of accuracy than 750 ms.)</p>
    <p class="calibre_2">During the calculation phase, you may start getting answers that seem strange. Don't be </p>
    <p class="calibre_2">too quick to dismiss them. If your arithmetic is correct, your understanding of the problem </p>
    <p class="calibre_2">or your model is probably wrong. This is valuable information. </p>
    <p class="calibre_2">
      <span class="bold">Keep Track of Your Estimating Prowess</span>
    </p>
    <p class="calibre_2">We think it's a great idea to record your estimates so you can see how close you were. If</p>
    <p class="calibre_2">an overall estimate involved calculating subestimates, keep track of these as well. Often</p>
    <p class="calibre_2">you'll find your estimates are pretty goodâ€”in fact, after a while, you'll come to expect this. </p>
    <p class="calibre_2">When an estimate turns out wrong, don't just shrug and walk away. Find out why it differed </p>
    <p class="calibre_2">from your guess. Maybe you chose some parameters that didn't match the reality of the </p>
    <p class="calibre_2">problem. Maybe your model was wrong. Whatever the reason, take some time to uncover </p>
    <p class="calibre_2">what happened. If you do, your next estimate will be better. </p>
    <p class="calibre_2">
      <span class="bold">Estimating Project Schedules</span>
    </p>
    <p class="calibre_2">The normal rules of estimating can break down in the face of the complexities and vagaries </p>
    <p class="calibre_2">of a sizable application development. We find that often the only way to determine the </p>
    <p class="calibre_2">timetable for a project is by gaining experience on that same project. This needn't be a </p>
    <p class="calibre_2">paradox if you practice incremental development, repeating the following steps. </p>
    <p class="calibre_2">Check requirements</p>
    <p class="calibre_2">Analyze risk</p>
    <p class="calibre_2">Design, implement, integrate</p>
    <p class="calibre_2">Validate with the users</p>
    <p class="calibre_2">Initially, you may have only a vague idea of how many iterations will be required, or how </p>
    <p class="calibre_2">long they may be. Some methods require you to nail this down as part of the initial plan, </p>
    <p class="calibre_2">but for all but the most trivial of projects this is a mistake. Unless you are doing an </p>
    <p class="calibre_2">application similar to a previous one, with the same team and the same technology, you'd </p>
    <p class="calibre_2">just be guessing. </p>
    <p class="calibre_2">So you complete the coding and testing of the initial functionality and mark this as the end </p>
    <p class="calibre_2">of the first increment. Based on that experience, you can refine your initial guess on the </p>
    <p class="calibre_2">number of iterations and what can be included in each. The refinement gets better and </p>
    <p class="calibre_2">better each time, and confidence in the schedule grows along with it. </p>
    <p class="calibre_2">
      <span class="bold">Tip 19</span>
    </p>
    <p class="calibre_2">Iterate the Schedule with the Code</p>
    <p class="calibre_2">This may not be popular with management, who typically want a single, hard-and-fast </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00251.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00034.jpg"/>
    </p>
    <p class="calibre_2">number before the project even starts. You'll have to help them understand that the team, </p>
    <p class="calibre_2">their productivity, and the environment will determine the schedule. By formalizing this, and </p>
    <p class="calibre_2">refining the schedule as part of each iteration, you'll be giving them the most accurate </p>
    <p class="calibre_2">scheduling estimates you can. </p>
    <p class="calibre_2">
      <span class="bold">What to Say When Asked for an Estimate</span>
    </p>
    <p class="calibre_2">You say " <span class="italic">I'll get back to you. </span>" </p>
    <p class="calibre_2">You almost always get better results if you slow the process down and spend some time </p>
    <p class="calibre_2">going through the steps we describe in this section. Estimates given at the coffee machine </p>
    <p class="calibre_2">will (like the coffee) come back to haunt you. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Algorithm Speed</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Start keeping a log of your estimates. For each, track how accurate you turned out </p>
    <p class="calibre_2">to be. If your error was greater than 50%, try to find out where your estimate went </p>
    <p class="calibre_2">wrong. </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <span class="bold">9. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">You are asked "Which has a higher bandwidth: a 1Mbps communications line </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">or a person walking between two computers with a full 4GB tape in their </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">pocket?" What constraints will you put on your answer to ensure that the </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">scope of your response is correct? (For example, you might say that the time </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">taken to access the tape is ignored.)</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">10. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">So, which has the higher bandwidth? </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00168.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00246.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Chapter 3. The Basic Tools</span>
    </p>
    <p class="calibre_2">Every craftsman starts his or her journey with a basic set of good-quality tools. A </p>
    <p class="calibre_2">woodworker might need rules, gauges, a couple of saws, some good planes, fine chisels, </p>
    <p class="calibre_2">drills and braces, mallets, and clamps. These tools will be lovingly chosen, will be built to </p>
    <p class="calibre_2">last, will perform specific jobs with little overlap with other tools, and, perhaps most </p>
    <p class="calibre_2">importantly, will feel right in the budding woodworker's hands. </p>
    <p class="calibre_2">Then begins a process of learning and adaptation. Each tool will have its own personality</p>
    <p class="calibre_2">and quirks, and will need its own special handling. Each must be sharpened in a unique</p>
    <p class="calibre_2">way, or held just so. Over time, each will wear according to use, until the grip looks like a</p>
    <p class="calibre_2">mold of the woodworker's hands and the cutting surface aligns perfectly with the angle at</p>
    <p class="calibre_2">which the tool is held. At this point, the tools become conduits from the craftsman's brain to</p>
    <p class="calibre_2">the finished productâ€”they have become extensions of his or her hands. Over time, the</p>
    <p class="calibre_2">woodworker will add new tools, such as biscuit cutters, laser-guided miter saws, dovetail</p>
    <p class="calibre_2">jigsâ€”all wonderful pieces of technology. But you can bet that he or she will be happiest</p>
    <p class="calibre_2">with one of those original tools in hand, feeling the plane sing as it slides through the wood. </p>
    <p class="calibre_2">Tools amplify your talent. The better your tools, and the better you know how to use them, </p>
    <p class="calibre_2">the more productive you can be. Start with a basic set of generally applicable tools. As you </p>
    <p class="calibre_2">gain experience, and as you come across special requirements, you'll add to this basic set. </p>
    <p class="calibre_2">Like the craftsman, expect to add to your toolbox regularly. Always be on the lookout for </p>
    <p class="calibre_2">better ways of doing things. If you come across a situation where you feel your current </p>
    <p class="calibre_2">tools can't cut it, make a note to look for something different or more powerful that would </p>
    <p class="calibre_2">have helped. Let need drive your acquisitions. </p>
    <p class="calibre_2">Many new programmers make the mistake of adopting a single power tool, such as a </p>
    <p class="calibre_2">particular integrated development environment (IDE), and never leave its cozy interface. </p>
    <p class="calibre_2">This really is a mistake. We need to be comfortable beyond the limits imposed by an IDE. </p>
    <p class="calibre_2">The only way to do this is to keep the basic tool set sharp and ready to use. </p>
    <p class="calibre_2">In this chapter we'll talk about investing in your own basic toolbox. As with any good </p>
    <p class="calibre_2">discussion on tools, we'll start (in <span class="italic">The Power of Plain Text</span>) by looking at your raw </p>
    <p class="calibre_2">materials, the stuff you'll be shaping. From there we'll move to the workbench, or in our </p>
    <p class="calibre_2">case the computer. How can you use your computer to get the most out of the tools you </p>
    <p class="calibre_2">use? We'll discuss this in <span class="italic">Shell Games. </span> Now that we have material and a bench to work </p>
    <p class="calibre_2">on, we'll turn to the tool you'll probably use more than any other, your editor. In <span class="italic">Power </span></p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00342.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00352.jpg"/>
    </p>
    <p class="calibre_2"><span class="italic">Editing, </span> we'll suggest ways of making you more efficient. </p>
    <p class="calibre_2">To ensure that we never lose any of our precious work, we should always use a <span class="italic">Source </span></p>
    <p class="calibre_2"><span class="italic">Code Control</span> systemâ€”even for things such as our personal address book! And, since Mr. </p>
    <p class="calibre_2">Murphy was really an optimist after all, you can't be a great programmer until you become</p>
    <p class="calibre_2">highly skilled at <span class="italic">Debugging. </span></p>
    <p class="calibre_2">You'll need some glue to bind much of the magic together. We discuss some possibilities, </p>
    <p class="calibre_2">such as awk, Perl, and Python, in <span class="italic">Text Manipulation. </span></p>
    <p class="calibre_2">Just as woodworkers sometimes build jigs to guide the construction of complex pieces, </p>
    <p class="calibre_2">programmers can write code that itself writes code. We discuss this in <span class="italic">Code Generators. </span></p>
    <p class="calibre_2">Spend time learning to use these tools, and at some point you'll be surprised to discover </p>
    <p class="calibre_2">your fingers moving over the keyboard, manipulating text without conscious thought. The </p>
    <p class="calibre_2">tools will have become extensions of your hands. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00272.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00287.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">The Power of Plain Text</span>
    </p>
    <p class="calibre_2">As Pragmatic Programmers, our base material isn't wood or iron, it's knowledge. We </p>
    <p class="calibre_2">gather requirements as knowledge, and then express that knowledge in our designs, </p>
    <p class="calibre_2">implementations, tests, and documents. And we believe that the best format for storing </p>
    <p class="calibre_2">knowledge persistently is <span class="italic">plain text. </span> With plain text, we give ourselves the ability to </p>
    <p class="calibre_2">manipulate knowledge, both manually and programmatically, using virtually every tool at </p>
    <p class="calibre_2">our disposal. </p>
    <p class="calibre_2">
      <span class="bold">What Is Plain Text? </span>
    </p>
    <p class="calibre_2"><span class="italic">Plain text</span> is made up of printable characters in a form that can be read and understood </p>
    <p class="calibre_2">directly by people. For example, although the following snippet is made up of printable </p>
    <p class="calibre_2">characters, it is meaningless. </p>
    <p class="calibre_2">Fieldl9=467abe</p>
    <p class="calibre_2">The reader has no idea what the significance of 467abe may be. A better choice would be </p>
    <p class="calibre_2">to make it <span class="italic">understandable</span> to humans. </p>
    <p class="calibre_2">DrawingType=UMLActivityDrawing</p>
    <p class="calibre_2">Plain text doesn't mean that the text is unstructured; XML, SGML, and HTML are great </p>
    <p class="calibre_2">examples of plain text that has a well-defined structure. You can do everything with plain </p>
    <p class="calibre_2">text that you could do with some binary format, including versioning. </p>
    <p class="calibre_2">Plain text tends to be at a higher level than a straight binary encoding, which is usually </p>
    <p class="calibre_2">derived directly from the implementation. Suppose you wanted to store a property called </p>
    <p class="calibre_2">uses_menus that can be either TRUE or FALSE. Using text, you might write this as</p>
    <p class="calibre_2">myprop.uses_menus=FALSE</p>
    <p class="calibre_2">Contrast this with 0010010101110101. </p>
    <p class="calibre_2">The problem with most binary formats is that the context necessary to understand the data </p>
    <p class="calibre_2">is separate from the data itself. You are artificially divorcing the data from its meaning. The </p>
    <p class="calibre_2">data may as well be encrypted; it is absolutely meaningless without the application logic to </p>
    <p class="calibre_2">parse it. With plain text, however, you can achieve a self-describing data stream that is </p>
    <p class="calibre_2">independent of the application that created it. </p>
    <p class="calibre_2">
      <span class="bold">Tip 20</span>
    </p>
    <p class="calibre_2">Keep Knowledge in Plain Text</p>
    <p class="calibre_2">
      <span class="bold">Drawbacks</span>
    </p>
    <p class="calibre_2">There are two major drawbacks to using plain text: (1) It may take more space to store than </p>
    <p class="calibre_2">a compressed binary format, and (2) it may be computationally more expensive to interpret </p>
    <p class="calibre_2">and process a plain text file. </p>
    <p class="calibre_2">Depending on your application, either or both of these situations may be unacceptableâ€”for</p>
    <p class="calibre_2">example, when storing satellite telemetry data, or as the internal format of a relational</p>
    <p class="calibre_2">database. </p>
    <p class="calibre_2">But even in these situations, it may be acceptable to store <span class="italic">metadata</span> about the raw data in </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">plain text (see Metaprogramming). </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">Some developers may worry that by putting metadata in plain text, they're exposing it to </p>
    <p class="calibre_2">the system's users. This fear is misplaced. Binary data may be more obscure than plain </p>
    <p class="calibre_2">text, but it is no more secure. If you worry about users seeing passwords, encrypt them. If </p>
    <p class="calibre_2">you don't want them changing configuration parameters, include a <span class="italic">secure hash</span><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[1] of all th</span></span></a>e</p>
    <p class="calibre_2">parameter values in the file as a checksum. </p>
    <p class="calibre_2">[1] MD5 is often used for this purpose. For an excellent introduction to the wonderful world of</p>
    <p class="calibre_2">cryptography, see [<span class="calibre_5"><span class="underline">Sch95]. </span></span></p>
    <p class="calibre_2">
      <span class="bold">The Power of Text</span>
    </p>
    <p class="calibre_2">Since <span class="italic">larger</span> and <span class="italic">slower</span> aren't the most frequently requested features from users, why </p>
    <p class="calibre_2">bother with plain text? What <span class="italic">are</span> the benefits? </p>
    <p class="calibre_2">Insurance against obsolescence</p>
    <p class="calibre_2">Leverage</p>
    <p class="calibre_2">Easier testing</p>
    <p class="calibre_2">
      <span class="bold">Insurance Against Obsolescence</span>
    </p>
    <p class="calibre_2">Human-readable forms of data, and self-describing data, will outlive all other forms of data </p>
    <p class="calibre_2">and the applications that created them. Period. </p>
    <p class="calibre_2">As long as the data survives, you will have a chance to be able to use itâ€”potentially long</p>
    <p class="calibre_2">after the original application that wrote it is defunct. </p>
    <p class="calibre_2">You can parse such a file with only partial knowledge of its format; with most binary files, </p>
    <p class="calibre_2">you must know all the details of the entire format in order to parse it successfully. </p>
    <p class="calibre_2">Consider a data file from some legacy system<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[2]</span></span></a> that you are given. You know little about</p>
    <p class="calibre_2">the original application; all that's important to you is that it maintained a list of clients' Social </p>
    <p class="calibre_2">Security numbers, which you need to find and extract. Among the data, you see</p>
    <p class="calibre_2">[2] All software becomes legacy as soon as it's written. </p>
    <p class="calibre_2">&lt;FIELD10&gt;123-45-6789&lt;/FIELD10&gt; </p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">&lt;FIELD10&gt;567-89-0123&lt;/FIELD10&gt; </p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">&lt;FIELD10&gt;901-23-4567&lt;/FIELD10&gt; </p>
    <p class="calibre_2">Recognizing the format of a Social Security number, you can quickly write a small program</p>
    <p class="calibre_2">to extract that dataâ€”even if you have no information on anything else in the file. </p>
    <p class="calibre_2">But imagine if the file had been formatted this way instead:</p>
    <p class="calibre_2">AC27123456789B11P</p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">XY43567890123QTYL</p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">6T2190123456788AM</p>
    <p class="calibre_2">You may not have recognized the significance of the numbers quite as easily. This is the </p>
    <p class="calibre_2">difference between <span class="italic">human readable</span> and <span class="italic">human understandable. </span></p>
    <p class="calibre_2">While we're at it, FIELD10 doesn't help much either. Something like</p>
    <p class="calibre_2">&lt;SSNO&gt;123-45-6789&lt;/SSNO&gt; </p>
    <p class="calibre_2">makes the exercise a no-brainerâ€”and ensures that the data will outlive any project that</p>
    <p class="calibre_2">created it. </p>
    <p class="calibre_2">
      <span class="bold">Leverage</span>
    </p>
    <p class="calibre_2">Virtually every tool in the computing universe, from source code management systems to </p>
    <p class="calibre_2">compiler environments to editors and stand-alone filters, can operate on plain text. </p>
    <p class="calibre_2">
      <span class="bold">The Unix Philosophy</span>
    </p>
    <p class="calibre_2">Unix is famous for being designed around the philosophy of small, sharp tools, </p>
    <p class="calibre_2">each intended to do one thing well. This philosphy is enabled by using a</p>
    <p class="calibre_2">common underlying formatâ€”the line-oriented, plain text file. Databases used for</p>
    <p class="calibre_2">system administration (users and passwords, networking configuration, and so</p>
    <p class="calibre_2">on) are all kept as plain text files. (some systems, such as Solaris, also maintain</p>
    <p class="calibre_2">a binary forms of certain databases as a performance optimization. The plain text</p>
    <p class="calibre_2">version is kept as an interface to the binary version.)</p>
    <p class="calibre_2">When a system crashes, you may be faced with only a minimal environment to </p>
    <p class="calibre_2">restore it (You may not be able to access graphics drivers, for instance), </p>
    <p class="calibre_2">Situations such as this can really make you appreciate the simplicity of plain text. </p>
    <p class="calibre_2">For instance, suppose you have a production deployment of a large application with a </p>
    <p class="calibre_2">complex site-specific configuration file (sendmail comes to mind). If this file is in plain text, </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">you could place it under a source code control system (see Source Code Control</span></span></a>), so that </p>
    <p class="calibre_2">you automatically keep a history of all changes. File comparison tools such as diff and fc</p>
    <p class="calibre_2">allow you to see at a glance what changes have been made, while sum allows you to </p>
    <p class="calibre_2">generate a checksum to monitor the file for accidental (or malicious) modification. </p>
    <p class="calibre_2">
      <span class="bold">Easier Testing</span>
    </p>
    <p class="calibre_2">If you use plain text to create synthetic data to drive system tests, then it is a simple matter </p>
    <p class="calibre_2">to add, update, or modify the test data <span class="italic">without having to create any special tools to do </span></p>
    <p class="calibre_2"><span class="italic">so. </span> Similarly, plain text output from regression tests can be trivially analyzed (with diff, for </p>
    <p class="calibre_2">instance) or subjected to more thorough scrutiny with Perl, Python, or some other scripting </p>
    <p class="calibre_2">tool. </p>
    <p class="calibre_2">
      <span class="bold">Lowest Common Denominator</span>
    </p>
    <p class="calibre_2">Even in the future of XML-based intelligent agents that travel the wild and dangerous </p>
    <p class="calibre_2">Internet autonomously, negotiating data interchange among themselves, the ubiquitous </p>
    <p class="calibre_2">text file will still be there. In fact, in heterogeneous environments the advantages of plain </p>
    <p class="calibre_2">text can outweigh all of the drawbacks. You need to ensure that all parties can </p>
    <p class="calibre_2">communicate using a common standard. Plain text is that standard. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Source Code Control</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Code Generators</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Metaprogramming</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Blackboards</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Ubiquitous Automation</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">It's All Writing</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Design a small address book database (name, phone number, and so on) using a </p>
    <p class="calibre_2">straightforward binary representation in your language of choice. Do this before </p>
    <p class="calibre_2">reading the rest of this challenge. </p>
    <p class="calibre_2">1. Translate that format into a plain text format using XML. </p>
    <p class="calibre_2">2. </p>
    <p class="calibre_2">For each version, add a new, variable-length field called <span class="italic">directions</span> in which </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00090.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00017.jpg"/>
    </p>
    <p class="calibre_2">you might enter directions to each person's house. </p>
    <p class="calibre_2">What issues come up regarding versioning and extensibility? Which form was </p>
    <p class="calibre_2">easier to modify? What about converting existing data? </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00268.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00316.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Shell Games</span>
    </p>
    <p class="calibre_2">Every woodworker needs a good, solid, reliable workbench, somewhere to hold work </p>
    <p class="calibre_2">pieces at a convenient height while he or she works them. The workbench becomes the </p>
    <p class="calibre_2">center of the wood shop, the craftsman returning to it time and time again as a piece takes </p>
    <p class="calibre_2">shape. </p>
    <p class="calibre_2">For a programmer manipulating files of text, that workbench is the command shell. From </p>
    <p class="calibre_2">the shell prompt, you can invoke your full repertoire of tools, using pipes to combine them </p>
    <p class="calibre_2">in ways never dreamt of by their original developers. From the shell, you can launch </p>
    <p class="calibre_2">applications, debuggers, browsers, editors, and utilities. You can search for files, query the </p>
    <p class="calibre_2">status of the system, and filter output. And by programming the shell, you can build </p>
    <p class="calibre_2">complex macro commands for activities you perform often. </p>
    <p class="calibre_2">For programmers raised on GUI interfaces and integrated development environments </p>
    <p class="calibre_2">(IDEs), this might seem an extreme position. After all, can't you do everything equally well </p>
    <p class="calibre_2">by pointing and clicking? </p>
    <p class="calibre_2">The simple answer is "no." GUI interfaces are wonderful, and they can be faster and more </p>
    <p class="calibre_2">convenient for some simple operations. Moving files, reading MIME-encoded e-mail, and </p>
    <p class="calibre_2">typing letters are all things that you might want to do in a graphical environment. But if you </p>
    <p class="calibre_2">do all your work using GUIs, you are missing out on the full capabilities of your </p>
    <p class="calibre_2">environment. You won't be able to automate common tasks, or use the full power of the </p>
    <p class="calibre_2">tools available to you. And you won't be able to combine your tools to create customized </p>
    <p class="calibre_2"><span class="italic">macro tools</span>. A benefit of GUIs is WYSIWYGâ€”what you see is what you get. The</p>
    <p class="calibre_2">disadvantage is WYSIAYGâ€”what you see is <span class="italic">all</span> you get. </p>
    <p class="calibre_2">GUI environments are normally limited to the capabilities that their designers intended. If</p>
    <p class="calibre_2">you need to go beyond the model the designer provided, you are usually out of luckâ€”and</p>
    <p class="calibre_2">more often than not, you <span class="italic">do</span> need to go beyond the model. Pragmatic Programmers don't</p>
    <p class="calibre_2">just cut code, or develop object models, or write documentation, or automate the build</p>
    <p class="calibre_2">processâ€”we do <span class="italic">all</span> of these things. The scope of any one tool is usually limited to the tasks </p>
    <p class="calibre_2">that the tool is expected to perform. For instance, suppose you need to integrate a code </p>
    <p class="calibre_2">preprocessor (to implement design-by-contract, or multi-processing pragmas, or some </p>
    <p class="calibre_2">such) into your IDE. Unless the designer of the IDE explicitly provided hooks for this </p>
    <p class="calibre_2">capability, you can't do it. </p>
    <p class="calibre_2">You may already be comfortable working from the command prompt, in which case you </p>
    <p class="calibre_2">can safely skip this section. Otherwise, you may need to be convinced that the shell is your </p>
    <p class="calibre_2">friend. </p>
    <p class="calibre_2">As a Pragmatic Programmer, you will constantly want to perform ad hoc</p>
    <p class="calibre_2">operationsâ€”things that the GUI may not support. The command line is better suited when</p>
    <p class="calibre_2">you want to quickly combine a couple of commands to perform a query or some other task. </p>
    <p class="calibre_2">Here are a few examples. </p>
    <p class="calibre_2">
      <span class="italic">
        <span class="bold">Find all</span>
      </span>
      <span class="bold"> . </span>
      <span class="italic">
        <span class="bold">cfiles modified more recently than your Makefile. </span>
      </span>
    </p>
    <p class="calibre_2">Shellâ€¦</p>
    <p class="calibre_2">find . -name ' *.c' -newer Makefile -print</p>
    <p class="calibre_2">GUIâ€¦.. Open the Explorer, navigate to the correct directory, click on the Makefile, and note the </p>
    <p class="calibre_2">modification time. Then bring up Tools/Find, and enter *.c for the file specification. Select the </p>
    <p class="calibre_2">date tab, and enter the date you noted for the Makefile in the first date field. Then hit OK. </p>
    <p class="calibre_2">
      <span class="italic">
        <span class="bold">Construct a zip/tar archive of my source. </span>
      </span>
    </p>
    <p class="calibre_2">Shellâ€¦</p>
    <p class="calibre_2">zip archive.zip *.h *.c - <span class="italic">or</span>-</p>
    <p class="calibre_2">tar cvf archive.tar *.h *.c</p>
    <p class="calibre_2">GUIâ€¦.. <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Bring up a ZIP utility (such as the shareware WinZip [URL 41], select "Create New Archive," </span></span></a></p>
    <p class="calibre_2">enter its name, select the source directory in the add dialog, set the filter to "* .c", click "Add," </p>
    <p class="calibre_2">set the filter to "* .h", click "Add," then close the archive.Â¨</p>
    <p class="calibre_2">
      <span class="italic">
        <span class="bold">Which Java files have not been changed in the last week? </span>
      </span>
    </p>
    <p class="calibre_2">Shellâ€¦</p>
    <p class="calibre_2">find . -name '*.java' -mtime +7 -print</p>
    <p class="calibre_2">GUIâ€¦.. Click and navigate to "Find files," click the "Named" field and type in "*.java", select the "Date </p>
    <p class="calibre_2">Modified" tab. Then select "Between." Click on the starting date and type in the starting date </p>
    <p class="calibre_2">of the beginning of the project. Click on the ending date and type in the date of a week ago </p>
    <p class="calibre_2">today (be sure to have a calendar handy). Click on "Find Now." </p>
    <p class="calibre_2"><span class="italic"><span class="bold">Of those files, which use the</span></span>&#13;
<span class="italic">awt</span><span class="italic"><span class="bold">libraries? </span></span></p>
    <p class="calibre_2">Shellâ€¦</p>
    <p class="calibre_2">find . -name '*.java' -mtime +7 -print |</p>
    <p class="calibre_2">xargs grep 'java.awt' </p>
    <p class="calibre_2">GUIâ€¦.. Load each file in the list from the previous example into an editor and search for the string </p>
    <p class="calibre_2">"java.awt". Write down the name of each file containing a match. </p>
    <p class="calibre_2">Clearly the list could go on. The shell commands may be obscure or terse, but they are </p>
    <p class="calibre_2">powerful and concise. And, because shell commands can be combined into script files (or </p>
    <p class="calibre_2">command files under Windows systems), you can build sequences of commands to </p>
    <p class="calibre_2">automate things you do often. </p>
    <p class="calibre_2">
      <span class="bold">Tip 21</span>
    </p>
    <p class="calibre_2">Use the Power of Command Shells</p>
    <p class="calibre_2">Gain familiarity with the shell, and you'll find your productivity soaring. Need to create a list </p>
    <p class="calibre_2">of all the unique package names explicitly imported by your Java code? The following </p>
    <p class="calibre_2">stores it in a file called "list." </p>
    <p class="calibre_2">grep '^import ' *.java |</p>
    <p class="calibre_2">sed -e's/.*import *//' -e's/;.*$//' |</p>
    <p class="calibre_2">sort -u &gt;list</p>
    <p class="calibre_2">If you haven't spent much time exploring the capabilities of the command shell on the </p>
    <p class="calibre_2">systems you use, this might appear daunting. However, invest some energy in becoming </p>
    <p class="calibre_2">familiar with your shell and things will soon start falling into place. Play around with your </p>
    <p class="calibre_2">command shell, and you'll be surprised at how much more productive it makes you. </p>
    <p class="calibre_2">
      <span class="bold">Shell Utilities and Windows Systems</span>
    </p>
    <p class="calibre_2">Although the command shells provided with Windows systems are improving gradually, </p>
    <p class="calibre_2">Windows command-line utilities are still inferior to their Unix counterparts. However, all is </p>
    <p class="calibre_2">not lost. </p>
    <p class="calibre_2">Cygnus Solutions has a package called Cygwin [<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">URL 31</span></span></a>]. As well as providing a Unix </p>
    <p class="calibre_2">compatibility layer for Windows, Cygwin comes with a collection of more than 120 Unix </p>
    <p class="calibre_2">utilities, including such favorites as 1s, grep, and find. The utilities and libraries may be </p>
    <p class="calibre_2">downloaded and used for free, but be sure to read their license. <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[3]</span></span></a> The Cygwin distribution</p>
    <p class="calibre_2">comes with the Bash shell. </p>
    <p class="calibre_2">[3] The GNU General Public License <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[URL 57] is a kind of legal virus that Open Source developers use t</span></span></a>o</p>
    <p class="calibre_2">protect their (and your) rights. You should spend some time reading it. In essence, it says that you can</p>
    <p class="calibre_2">use and modify GPL'd software, but if you distribute any modifications they must be licensed according to</p>
    <p class="calibre_2">the GPL (and marked as such), and you must make source available. That's the virus partâ€”whenever</p>
    <p class="calibre_2">you derive a work from a GPL'd work, your derived work must also be GPL'd. However, it does not limit</p>
    <p class="calibre_2">you in any way when simply using the toolsâ€”the ownership and licensing of software developed using</p>
    <p class="calibre_2">the tools are up to you. </p>
    <p class="calibre_2">
      <span class="bold">Using Unix Tools Under Windows</span>
    </p>
    <p class="calibre_2">We love the availability of high-quality Unix tools under Windows, and use them </p>
    <p class="calibre_2">daily. However, be aware that there are integration issues. Unlike their Ms-dos </p>
    <p class="calibre_2">counterparts, these utilities are sensitive to the case of filenames, so ls a*.bat</p>
    <p class="calibre_2">won't find AUTOEXEC.BAT. You may also come across problems with filenames </p>
    <p class="calibre_2">containing spaces, and with differences in path separators. Finally, there are </p>
    <p class="calibre_2">interesting problems when running Ms-dos programs that expect Ms-DOS-style </p>
    <p class="calibre_2">arguments under the Unix shells, For examples, the Java utilities from JavaSoft </p>
    <p class="calibre_2">use a colon as their CLASSPATH separators under Unix, but use a semicolon </p>
    <p class="calibre_2">under MS-DOS. As a result, a Bash or ksh script that runs on a Unix box will run </p>
    <p class="calibre_2">identically under Windows, but the command line it passes to Java will be </p>
    <p class="calibre_2">interpreted incorrectly. </p>
    <p class="calibre_2">Alternatively, David Korn (of Korn shell fame) has put together a package called uwin. This</p>
    <p class="calibre_2">has the same aims as the Cygwin distributionâ€”it is a Unix development environment under</p>
    <p class="calibre_2">Windows. UWIN comes with a version of the Korn shell. Commercial versions are available</p>
    <p class="calibre_2">from Global Technologies, Ltd. <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[URL 30]. In addition, AT&amp;T allows free downloading of the </span></span></a></p>
    <p class="calibre_2">package for evaluation and academic use. Again, read their license before using. </p>
    <p class="calibre_2">Finally, Tom Christiansen is (at the time of writing) putting together <span class="italic">Perl Power Tools, </span> an </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">attempt to implement all the familiar Unix utilities portably, in Perl [URL 32], </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Ubiquitous Automation</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00028.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00341.jpg"/>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Are there things that you're currently doing manually in a GUI? Do you ever pass </p>
    <p class="calibre_2">instructions to colleagues that involve a number of individual "click this button," </p>
    <p class="calibre_2">"select this item" steps? Could these be automated? </p>
    <p class="calibre_2">Whenever you move to a new environment, make a point of finding out what shells </p>
    <p class="calibre_2">are available. See if you can bring your current shell with you. </p>
    <p class="calibre_2">Investigate alternatives to your current shell. If you come across a problem your </p>
    <p class="calibre_2">shell can't address, see if an alternative shell would cope better. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00098.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00253.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_14" src="images/00292.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_15" src="images/00068.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_16" src="images/00096.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_17" src="images/00191.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_18" src="images/00032.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Power Editing</span>
    </p>
    <p class="calibre_2">We've talked before about tools being an extension of your hand. Well, this applies to </p>
    <p class="calibre_2">editors more than to any other software tool. You need to be able to manipulate text as </p>
    <p class="calibre_2">effortlessly as possible, because text is the basic raw material of programming. Let's look </p>
    <p class="calibre_2">at some common features and functions that help you get the most from your editing </p>
    <p class="calibre_2">environment. </p>
    <p class="calibre_2">
      <span class="bold">One Editor</span>
    </p>
    <p class="calibre_2">We think it is better to know one editor very well, and use it for all editing tasks: code, </p>
    <p class="calibre_2">documentation, memos, system administration, and so on. Without a single editor, you face </p>
    <p class="calibre_2">a potential modern day Babel of confusion. You may have to use the built-in editor in each </p>
    <p class="calibre_2">language's IDE for coding, and an all-in-one office product for documentation, and maybe a </p>
    <p class="calibre_2">different built-in editor for sending e-mail. Even the keystrokes you use to edit command </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">lines in the shell may be different.[4] It is difficult to be proficient in any of thes</span></span></a>e</p>
    <p class="calibre_2">environments if you have a different set of editing conventions and commands in each. </p>
    <p class="calibre_2">[4] Ideally, the shell you use should have keybindings that match the ones used by your editor. Bash, for</p>
    <p class="calibre_2">instance, supports both vi and emacs keybindings. </p>
    <p class="calibre_2">You need to be proficient. Simply typing linearly and using a mouse to cut and paste is not </p>
    <p class="calibre_2">enough. You just can't be as effective that way as you can with a powerful editor under </p>
    <p class="calibre_2">your fingers. Typing </p>
    <p class="calibre_2">or </p>
    <p class="calibre_2">ten times to move the cursor left to the </p>
    <p class="calibre_2">beginning of a line isn't as efficient as typing a single key such as </p>
    <p class="calibre_2">or </p>
    <p class="calibre_2">. </p>
    <p class="calibre_2">
      <span class="bold">Tip 22</span>
    </p>
    <p class="calibre_2">Use a Single Editor Well</p>
    <p class="calibre_2">Choose an editor, know it thoroughly, and use it for all editing tasks. If you use a single </p>
    <p class="calibre_2">editor (or set of keybindings) across all text editing activities, you don't have to stop and </p>
    <p class="calibre_2">think to accomplish text manipulation: the necessary keystrokes will be a reflex. The editor </p>
    <p class="calibre_2">will be an extension of your hand; the keys will sing as they slice their way through text and </p>
    <p class="calibre_2">thought. That's our goal. </p>
    <p class="calibre_2">Make sure that the editor you choose is available on all platforms you use. Emacs, vi, </p>
    <p class="calibre_2">CRiSP, Brief, and others are available across multiple platforms, often in both GUI and </p>
    <p class="calibre_2">non-GUI (text screen) versions. </p>
    <p class="calibre_2">
      <span class="bold">Editor Features</span>
    </p>
    <p class="calibre_2">Beyond whatever features you find particularly useful and comfortable, here are some </p>
    <p class="calibre_2">basic abilities that we think every decent editor should have. If your editor falls short in any </p>
    <p class="calibre_2">of these areas, then this may be the time to consider moving on to a more advanced one. </p>
    <p class="calibre_2"><span class="bold">Configurable. </span> All aspects of the editor should be configurable to your</p>
    <p class="calibre_2">preferences, including fonts, colors, window sizes, and keystroke bindings (which </p>
    <p class="calibre_2">keys perform what commands). Using only keystrokes for common editing </p>
    <p class="calibre_2">operations is more efficient than mouse or menu-driven commands, because your </p>
    <p class="calibre_2">hands never leave the keyboard. </p>
    <p class="calibre_2"><span class="bold">Extensible. </span> An editor shouldn't be obsolete just because a new programming</p>
    <p class="calibre_2">language comes out. It should be able to integrate with whatever compiler </p>
    <p class="calibre_2">environment you are using. You should be able to "teach" it the nuances of any </p>
    <p class="calibre_2">new language or text format (XML, HTML version 9, and so on). </p>
    <p class="calibre_2"><span class="bold">Programmable. </span> You should be able to program the editor to perform complex, </p>
    <p class="calibre_2">multistep tasks. This can be done with macros or with a built-in scripting </p>
    <p class="calibre_2">programming language (Emacs uses a variant of Lisp, for instance). </p>
    <p class="calibre_2">In addition, many editors support features that are specific to a particular programming </p>
    <p class="calibre_2">language, such as:</p>
    <p class="calibre_2">Syntax highlighting</p>
    <p class="calibre_2">Auto-completion</p>
    <p class="calibre_2">Auto-indentation</p>
    <p class="calibre_2">Initial code or document boilerplate</p>
    <p class="calibre_2">
      <img class="calibre_19" src="images/00148.jpg"/>
    </p>
    <p class="calibre_2">Tie-in to help systems</p>
    <p class="calibre_2">IDE-like features (compile, debug, and so on)</p>
    <p class="calibre_2">A feature such as syntax highlighting may sound like a frivolous extra, but in reality it can </p>
    <p class="calibre_2">be very useful and enhance your productivity. Once you get used to seeing keywords </p>
    <p class="calibre_2">appear in a different color or font, a mistyped keyword that <span class="italic">doesn't</span> appear that way jumps </p>
    <p class="calibre_2">out at you long before you fire up the compiler. </p>
    <p class="calibre_2">Having the ability to compile and navigate directly to errors within the editor environment is </p>
    <p class="calibre_2">very handy on big projects. Emacs in particular is adept at this style of interaction. </p>
    <p class="calibre_2">
      <span class="bold">Productivity</span>
    </p>
    <p class="calibre_2">A surprising number of people we've met use the Windows notepad utility to edit their</p>
    <p class="calibre_2">source code. This is like using a teaspoon as a shovelâ€”simply typing and using basic</p>
    <p class="calibre_2">mouse-based cut and paste is not enough. </p>
    <p class="calibre_2">What sort of things will you need to do that <span class="italic">can't</span> be done in this way? </p>
    <p class="calibre_2">Well, there's cursor movement, to start with. Single keystrokes that move you in units of </p>
    <p class="calibre_2">words, lines, blocks, or functions are far more efficient than repeatedly typing a keystroke </p>
    <p class="calibre_2">that moves you character by character or line by line. </p>
    <p class="calibre_2">Or suppose you are writing Java code. You like to keep your import statements in </p>
    <p class="calibre_2">alphabetical order, and someone else has checked in a few files that don't adhere to this </p>
    <p class="calibre_2">standard (this may sound extreme, but on a large project it can save you a lot of time </p>
    <p class="calibre_2">scanning through a long list of import statements). You'd like to go quickly through a few </p>
    <p class="calibre_2">files and sort a small section of them. In editors such as vi and Emacs you can do this </p>
    <p class="calibre_2">easily (see <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Figure 3.1). Try </span></span></a>&#13;
<span class="italic">that</span> in notepad. </p>
    <p class="calibre_2">
      <span class="bold">Figure 3.1. Sorting lines in an editor</span>
    </p>
    <p class="calibre_2">Some editors can help streamline common operations. For instance, when you create a </p>
    <p class="calibre_2">new file in a particular language, the editor can supply a template for you. It might include:</p>
    <p class="calibre_2">Name of the class or module filled in (derived from the filename)</p>
    <p class="calibre_2">Your name and/or copyright statements</p>
    <p class="calibre_2">Skeletons for constructs in that language (constructor and destructor declarations, </p>
    <p class="calibre_2">for example)</p>
    <p class="calibre_2">Another useful feature is auto-indenting. Rather than having to indent manually (by using </p>
    <p class="calibre_2">space or tab), the editor automatically indents for you at the appropriate time (after typing </p>
    <p class="calibre_2">an open brace, for example). The nice part about this feature is that you can use the editor </p>
    <p class="calibre_2">to provide a consistent indentation style for your project. <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[5]</span></span></a></p>
    <p class="calibre_2">[5] The Linux kernel is developed this way. Here you have geographically dispersed developers, many</p>
    <p class="calibre_2">working on the same pieces of code. There is a published list of settings (in this case, for Emacs) that </p>
    <p class="calibre_2">describes the required indentation style. </p>
    <p class="calibre_2">
      <span class="bold">Where to Go from Here</span>
    </p>
    <p class="calibre_2">This sort of advice is particularly hard to write because virtually every reader is at a </p>
    <p class="calibre_2">different level of comfort and expertise with the editor(s) they are currently using. So, to </p>
    <p class="calibre_2">summarize, and to provide some guidance on where to go next, find yourself in the </p>
    <p class="calibre_2">left-hand column of the chart, and look at the right-hand column to see what we think you </p>
    <p class="calibre_2">should do. </p>
    <p class="calibre_2">
      <span class="italic">
        <span class="bold">If this sounds like youâ€¦</span>
      </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Then think aboutâ€¦</span>
    </p>
    <p class="calibre_2">
      <span class="italic">I use only basic features of </span>
    </p>
    <p class="calibre_2">Pick a powerful editor and learn it well. </p>
    <p class="calibre_2">
      <span class="italic">many different editors. </span>
    </p>
    <p class="calibre_2">
      <span class="italic">I have a favorite editor, but I </span>
    </p>
    <p class="calibre_2">Learn them. Cut down the number of keystrokes you need to type. </p>
    <p class="calibre_2">
      <span class="italic">don't use all of its features. </span>
    </p>
    <p class="calibre_2"><span class="italic">I have a favorite editor and use </span> Try to expand and use it for more tasks than you do already. </p>
    <p class="calibre_2">
      <span class="italic">it where possible. </span>
    </p>
    <p class="calibre_2"><span class="italic">I think you are nuts. Notepad is </span> As long as you are happy and productive, go for it! But if you find </p>
    <p class="calibre_2">
      <span class="italic">the best editor ever made. </span>
    </p>
    <p class="calibre_2">yourself subject to "editor envy," you may need to reevaluate your </p>
    <p class="calibre_2">position. </p>
    <p class="calibre_2">
      <span class="bold">What Editors Are Available? </span>
    </p>
    <p class="calibre_2">Having recommended that you master a decent editor, which one do we recommend? </p>
    <p class="calibre_2">Well, we're going to duck that question; your choice of editor is a personal one (some </p>
    <p class="calibre_2">would even say a religious one!). However, in <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Appendix A</span></span></a>, we list a number of popular </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00280.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00029.jpg"/>
    </p>
    <p class="calibre_2">editors and where to get them. </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Some editors use full-blown languages for customization and scripting. Emacs, for </p>
    <p class="calibre_2">example, uses Lisp. As one of the new languages you are going to learn this year, </p>
    <p class="calibre_2">learn the language your editor uses. For anything you find yourself doing </p>
    <p class="calibre_2">repeatedly, develop a set of macros (or equivalent) to handle it. </p>
    <p class="calibre_2">Do you know everything your editor is capable of doing? Try to stump your </p>
    <p class="calibre_2">colleagues who use the same editor. Try to accomplish any given editing task in as </p>
    <p class="calibre_2">few keystrokes as possible. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00334.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00312.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_20" src="images/00170.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_20" src="images/00356.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Source Code Control</span>
    </p>
    <p class="calibre_2">
      <span class="italic">Progress, far from consisting in change, depends on retentiveness. Those who cannot </span>
    </p>
    <p class="calibre_2">
      <span class="italic">remember the past are condemned to repeat it. </span>
    </p>
    <p class="calibre_2">
      <span class="bold">George Santayana, </span>
      <span class="italic">
        <span class="bold"> Life of Reason</span>
      </span>
    </p>
    <p class="calibre_2">One of the important things we look for in a user interface is the </p>
    <p class="calibre_2">keyâ€”a single</p>
    <p class="calibre_2">button that forgives us our mistakes. It's even better if the environment supports multiple</p>
    <p class="calibre_2">levels of undo and redo, so you can go back and recover from something that happened a</p>
    <p class="calibre_2">couple of minutes ago. But what if the mistake happened last week, and you've turned your</p>
    <p class="calibre_2">computer on and off ten times since then? Well, that's one of the many benefits of using a</p>
    <p class="calibre_2">source code control system: it's a giant </p>
    <p class="calibre_2">keyâ€”a project-wide time machine that</p>
    <p class="calibre_2">can return you to those halcyon days of last week, when the code actually compiled and</p>
    <p class="calibre_2">ran. </p>
    <p class="calibre_2">Source code control systems, or the more widely scoped <span class="italic">configuration management</span></p>
    <p class="calibre_2">systems, keep track of every change you make in your source code and documentation. </p>
    <p class="calibre_2">The better ones can keep track of compiler and OS versions as well. With a properly </p>
    <p class="calibre_2">configured source code control system, <span class="italic">you can always go back to a previous version of </span></p>
    <p class="calibre_2">
      <span class="italic">your software. </span>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">But a source code control system (SCCS[6] ) does far more than undo mistakes. A goo</span></span></a>d</p>
    <p class="calibre_2">SCCS will let you track changes, answering questions such as: Who made changes in this </p>
    <p class="calibre_2">line of code? What's the difference between the current version and last week's? How </p>
    <p class="calibre_2">many lines of code did we change in this release? Which files get changed most often? </p>
    <p class="calibre_2">This kind of information is invaluable for bug-tracking, audit, performance, and quality </p>
    <p class="calibre_2">purposes. </p>
    <p class="calibre_2">[6] We use the uppercase SCCS to refer to generic source code control systems. There is also a specific</p>
    <p class="calibre_2">system called "sccs," originally released with AT&amp;T System V Unix. </p>
    <p class="calibre_2">An SCCS will also let you identify releases of your software. Once identified, you will </p>
    <p class="calibre_2">always be able to go back and regenerate the release, independent of changes that may </p>
    <p class="calibre_2">have occurred later. </p>
    <p class="calibre_2">We often use an SCCS to manage branches in the development tree. For example, once </p>
    <p class="calibre_2">you have released some software, you'll normally want to continue developing for the next </p>
    <p class="calibre_2">release. At the same time, you'll need to deal with bugs in the current release, shipping </p>
    <p class="calibre_2">fixed versions to clients. You'll want these bug fixes rolled into the next release (if </p>
    <p class="calibre_2">appropriate), but you don't want to ship code under development to clients. With an SCCS </p>
    <p class="calibre_2">you can generate branches in the development tree each time you generate a release. You </p>
    <p class="calibre_2">apply bug fixes to code in the branch, and continue developing on the main trunk. Since </p>
    <p class="calibre_2">the bug fixes may be relevant to the main trunk as well, some systems allow you to merge </p>
    <p class="calibre_2">selected changes from the branch back into the main trunk automatically. </p>
    <p class="calibre_2">Source code control systems may keep the files they maintain in a central repositoryâ€”a</p>
    <p class="calibre_2">great candidate for archiving. </p>
    <p class="calibre_2">Finally, some products may allow two or more users to be working concurrently on the </p>
    <p class="calibre_2">same set of files, even making concurrent changes in the same file. The system then </p>
    <p class="calibre_2">manages the merging of these changes when the files are sent back to the repository. </p>
    <p class="calibre_2">Although seemingly risky, such systems work well in practice on projects of all sizes. </p>
    <p class="calibre_2">
      <span class="bold">Tip 23</span>
    </p>
    <p class="calibre_2">Always Use Source Code Control</p>
    <p class="calibre_2">Always. Even if you are a single-person team on a one-week project. Even if it's a </p>
    <p class="calibre_2">"throw-away" prototype. Even if the stuff you're working on isn't source code. Make sure </p>
    <p class="calibre_2">that <span class="italic">everything</span> is under source code controlâ€”documentation, phone number lists, memos</p>
    <p class="calibre_2">to vendors, makefiles, build and release procedures, that little shell script that burns the CD</p>
    <p class="calibre_2">masterâ€”everything. We routinely use source code control on just about everything we</p>
    <p class="calibre_2">type (including the text of this book). Even if we're not working on a project, our day-to-day</p>
    <p class="calibre_2">work is secured in a repository. </p>
    <p class="calibre_2">
      <span class="bold">Source Code Control and Builds</span>
    </p>
    <p class="calibre_2">There is a tremendous hidden benefit in having an entire project under the umbrella of a </p>
    <p class="calibre_2">source code control system: you can have product builds that are <span class="italic">automatic</span> and </p>
    <p class="calibre_2">
      <span class="italic">repeatable. </span>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00022.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00333.jpg"/>
    </p>
    <p class="calibre_2">The project build mechanism can pull the latest source out of the repository automatically. </p>
    <p class="calibre_2">It can run in the middle of the night after everyone's (hopefully) gone home. You can run</p>
    <p class="calibre_2">automatic regression tests to ensure that the day's coding didn't break anything. The</p>
    <p class="calibre_2">automation of the build ensures consistencyâ€”there are no manual procedures, and you</p>
    <p class="calibre_2">won't need developers remembering to copy code into some special build area. </p>
    <p class="calibre_2">The build is repeatable because you can always rebuild the source as it existed on a given </p>
    <p class="calibre_2">date. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00042.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00115.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00249.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00101.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">But My Team Isn't Using Source Code Control</span>
    </p>
    <p class="calibre_2">Shame on them! Sounds like an opportunity to do some evangelizing! However, while you </p>
    <p class="calibre_2">wait for them to see the light, perhaps you should implement your own private source </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">control. Use one of the freely available tools we list in Appendix A</span></span></a>, and make a point of </p>
    <p class="calibre_2">keeping your personal work safely tucked into a repository (as well as doing whatever your </p>
    <p class="calibre_2">project requires). Although this may seem to be duplication of effort, we can pretty much </p>
    <p class="calibre_2">guarantee it will save you grief (and save your project money) the first time you need to </p>
    <p class="calibre_2">answer questions such as "What did you do to the <span class="italic">xyz</span> module?" and "What broke the </p>
    <p class="calibre_2">build?" This approach may also help convince your management that source code control </p>
    <p class="calibre_2">really works. </p>
    <p class="calibre_2">Don't forget that an SCCS is equally applicable to the things you do outside of work. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00345.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00099.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00097.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00252.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Source Code Control Products</span>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Appendix A, gives URLs for representative source code control systems, some commercia</span></span></a>l</p>
    <p class="calibre_2">and others freely available. And many more products are availableâ€”look for pointers to the</p>
    <p class="calibre_2">configuration management FAQ. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Orthogonality</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">The Power of Plain Text</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">It's All Writing</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Even if you are not able to use an SCCS at work, install RCS or CVS on a personal </p>
    <p class="calibre_2">system. Use it to manage your pet projects, documents you write, and (possibly) </p>
    <p class="calibre_2">configuration changes applied to the computer system itself. </p>
    <p class="calibre_2">Take a look at some of the Open Source projects for which publicly accessible </p>
    <p class="calibre_2">archives are available on the Web (such as Mozilla [<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">URL 51</span></span></a><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">], KDE [URL 54</span></span></a>], and </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">the Gimp [URL 55</span></span></a>]). How do you get updates of the source? How do you make</p>
    <p class="calibre_2">changesâ€”does the project regulate access or arbitrate the inclusion of changes? </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00038.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00340.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Debugging</span>
    </p>
    <p class="calibre_2">
      <span class="italic">It is a painful thing</span>
    </p>
    <p class="calibre_2">
      <span class="italic">To look at your own trouble and know</span>
    </p>
    <p class="calibre_2">
      <span class="italic">That you yourself and no one else has made it</span>
    </p>
    <p class="calibre_2">
      <span class="bold">Sophocles, </span>
      <span class="italic">
        <span class="bold">Ajax</span>
      </span>
    </p>
    <p class="calibre_2">The word <span class="italic">bug</span> has been used to describe an "object of terror" ever since the fourteenth </p>
    <p class="calibre_2">century. Rear Admiral Dr. Grace Hopper, the inventor of COBOL, is credited with </p>
    <p class="calibre_2">observing the first <span class="italic">computer bugâ€”</span> literally, a moth caught in a relay in an early computer</p>
    <p class="calibre_2">system. When asked to explain why the machine wasn't behaving as intended, a</p>
    <p class="calibre_2">technician reported that there was "a bug in the system," and dutifully taped itâ€”wings and</p>
    <p class="calibre_2">allâ€”into the log book. </p>
    <p class="calibre_2">Regrettably, we still have "bugs" in the system, albeit not the flying kind. But the fourteenth</p>
    <p class="calibre_2">century meaningâ€”a bogeymanâ€”is perhaps even more applicable now than it was then. </p>
    <p class="calibre_2">Software defects manifest themselves in a variety of ways, from misunderstood</p>
    <p class="calibre_2">requirements to coding errors. Unfortunately, modern computer systems are still limited to</p>
    <p class="calibre_2">doing what you <span class="italic">tell</span> them to do, not necessarily what you <span class="italic">want</span> them to do. </p>
    <p class="calibre_2">No one writes perfect software, so it's a given that debugging will take up a major portion of </p>
    <p class="calibre_2">your day. Let's look at some of the issues involved in debugging and some general </p>
    <p class="calibre_2">strategies for finding elusive bugs. </p>
    <p class="calibre_2">
      <span class="bold">Psychology of Debugging</span>
    </p>
    <p class="calibre_2">Debugging itself is a sensitive, emotional subject for many developers. Instead of attacking </p>
    <p class="calibre_2">it as a puzzle to be solved, you may encounter denial, finger pointing, lame excuses, or just </p>
    <p class="calibre_2">plain apathy. </p>
    <p class="calibre_2">Embrace the fact that debugging is just <span class="italic">problem solving, </span> and attack it as such. </p>
    <p class="calibre_2">Having found someone else's bug, you can spend time and energy laying blame on the </p>
    <p class="calibre_2">filthy culprit who created it. In some workplaces this is part of the culture, and may be </p>
    <p class="calibre_2">cathartic. However, in the technical arena, you want to concentrate on fixing the <span class="italic">problem, </span></p>
    <p class="calibre_2">not the blame. </p>
    <p class="calibre_2">
      <span class="bold">Tip 24</span>
    </p>
    <p class="calibre_2">Fix the Problem, Not the Blame</p>
    <p class="calibre_2">It doesn't really matter whether the bug is your fault or someone else's. It is still your </p>
    <p class="calibre_2">problem. </p>
    <p class="calibre_2">
      <span class="bold">A Debugging Mindset</span>
    </p>
    <p class="calibre_2">
      <span class="italic">The easiest person to deceive is one's self</span>
    </p>
    <p class="calibre_2">
      <span class="bold">Edward Bulwer-Lytton, </span>
      <span class="italic">
        <span class="bold">The Disowned</span>
      </span>
    </p>
    <p class="calibre_2">Before you start debugging, it's important to adopt the right mindset. You need to turn off </p>
    <p class="calibre_2">many of the defenses you use each day to protect your ego, tune out any project </p>
    <p class="calibre_2">pressures you may be under, and get yourself comfortable. Above all, remember the first </p>
    <p class="calibre_2">rule of debugging:</p>
    <p class="calibre_2">
      <span class="bold">Tip 25</span>
    </p>
    <p class="calibre_2">Don't Panic</p>
    <p class="calibre_2">It's easy to get into a panic, especially if you are facing a deadline, or have a nervous boss </p>
    <p class="calibre_2">or client breathing down your neck while you are trying to find the cause of the bug. But it is </p>
    <p class="calibre_2">very important to step back a pace, and actually <span class="italic">think</span> about what could be causing the </p>
    <p class="calibre_2">symptoms that you believe indicate a bug. </p>
    <p class="calibre_2">If your first reaction on witnessing a bug or seeing a bug report is "that's impossible," you </p>
    <p class="calibre_2">are plainly wrong. Don't waste a single neuron on the train of thought that begins "but that </p>
    <p class="calibre_2">can't happen" because quite clearly it <span class="italic">can, </span> and has. </p>
    <p class="calibre_2">Beware of myopia when debugging. Resist the urge to fix just the symptoms you see: it is </p>
    <p class="calibre_2">more likely that the actual fault may be several steps removed from what you are </p>
    <p class="calibre_2">observing, and may involve a number of other related things. Always try to discover the </p>
    <p class="calibre_2">root cause of a problem, not just this particular appearance of it. </p>
    <p class="calibre_2">
      <span class="bold">Where to Start</span>
    </p>
    <p class="calibre_2">Before you <span class="italic">start</span> to look at the bug, make sure that you are working on code that compiled</p>
    <p class="calibre_2">cleanlyâ€”without warnings. We routinely set compiler warning levels as high as possible. It</p>
    <p class="calibre_2">doesn't make sense to waste time trying to find a problem that the compiler could find for</p>
    <p class="calibre_2">you! We need to concentrate on the harder problems at hand. </p>
    <p class="calibre_2">When trying to solve any problem, you need to gather all the relevant data. Unfortunately, </p>
    <p class="calibre_2">bug reporting isn't an exact science. It's easy to be misled by coincidences, and you can't </p>
    <p class="calibre_2">afford to waste time debugging coincidences. You first need to be accurate in your </p>
    <p class="calibre_2">observations. </p>
    <p class="calibre_2">Accuracy in bug reports is further diminished when they come through a third partyâ€”you</p>
    <p class="calibre_2">may actually need to <span class="italic">watch</span> the user who reported the bug in action to get a sufficient level </p>
    <p class="calibre_2">of detail. </p>
    <p class="calibre_2">Andy once worked on a large graphics application. Nearing release, the testers reported </p>
    <p class="calibre_2">that the application crashed every time they painted a stroke with a particular brush. The </p>
    <p class="calibre_2">programmer responsible argued that there was nothing wrong with it; he had tried painting </p>
    <p class="calibre_2">with it, and it worked just fine. This dialog went back and forth for several days, with </p>
    <p class="calibre_2">tempers rapidly rising. </p>
    <p class="calibre_2">Finally, we got them together in the same room. The tester selected the brush tool and </p>
    <p class="calibre_2">painted a stroke from the upper right corner to the lower left corner. The application </p>
    <p class="calibre_2">exploded. "Oh," said the programmer, in a small voice, who then sheepishly admitted that </p>
    <p class="calibre_2">he had made test strokes only from the lower left to the upper right, which did not expose </p>
    <p class="calibre_2">the bug. </p>
    <p class="calibre_2">There are two points to this story:</p>
    <p class="calibre_2">You may need to interview the user who reported the bug in order to gather more </p>
    <p class="calibre_2">data than you were initially given. </p>
    <p class="calibre_2">Artificial tests (such as the programmer's single brush stroke from bottom to top) </p>
    <p class="calibre_2">don't exercise enough of an application. You must brutally test both boundary </p>
    <p class="calibre_2">conditions and realistic end-user usage patterns. You need to do this systematically </p>
    <p class="calibre_2">(see <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Ruthless Testing</span></span></a>). </p>
    <p class="calibre_2">
      <span class="bold">Debugging Strategies</span>
    </p>
    <p class="calibre_2">Once <span class="italic">you</span> think you know what is going on, it's time to find out what the <span class="italic">program</span> thinks is </p>
    <p class="calibre_2">going on. </p>
    <p class="calibre_2">
      <span class="bold">Bug Reproduction</span>
    </p>
    <p class="calibre_2">No, our bugs aren't really multiplying (although some of them are probably old </p>
    <p class="calibre_2">enough to do it legally). We're talking about a different kind of reproduction. </p>
    <p class="calibre_2">The best way to start fixing a bug is to make it reproducible. After all, if you can't </p>
    <p class="calibre_2">reproduce it, how will you know if it is ever fixed? </p>
    <p class="calibre_2">But we want more than a bug that can be reproduced by following some long </p>
    <p class="calibre_2">series of steps; we want a bug that can be reproduced with a <span class="italic">single command. </span></p>
    <p class="calibre_2">It's a lot harder to fix a bug if you have to go through 15 steps to get to the point </p>
    <p class="calibre_2">where the bug shows up. Sometimes by forcing yourself to isolate the </p>
    <p class="calibre_2">circumstances that display the bug, you'll even gain an insight on how to fix it. </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">See Ubiquitos Automation, for other ideas along these lines. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Visualize Your Data</span>
    </p>
    <p class="calibre_2">Often, the easiest way to discern what a program is doingâ€”or what it is going to doâ€”is to</p>
    <p class="calibre_2">get a good look at the data it is operating on. The simplest example of this is a</p>
    <p class="calibre_2">straightforward "variable name = data value" approach, which may be implemented as </p>
    <p class="calibre_2">printed text, or as fields in a GUI dialog box or list. </p>
    <p class="calibre_2">But you can gain a much deeper insight into your data by using a debugger that allows you </p>
    <p class="calibre_2">to <span class="italic">visualize</span> your data and all of the interrelationships that exist. There are debuggers that </p>
    <p class="calibre_2">can represent your data as a 3D fly-over through a virtual reality landscape, or as a 3D </p>
    <p class="calibre_2">waveform plot, or just as simple structural diagrams, as shown in <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Figure 3.2 on the next </span></span></a></p>
    <p class="calibre_2">
      <img class="calibre_21" src="images/00354.jpg"/>
    </p>
    <p class="calibre_2">page. As you single-step through your program, pictures like these can be worth much </p>
    <p class="calibre_2">more than a thousand words, as the bug you've been hunting suddenly jumps out at you. </p>
    <p class="calibre_2">
      <span class="bold">Figure 3.2. Sample debugger diagram of a circular linked list. The arrows represent pointers to </span>
    </p>
    <p class="calibre_2">
      <span class="bold">nodes. </span>
    </p>
    <p class="calibre_2">Even if your debugger has limited support for visualizing data, you can still do it</p>
    <p class="calibre_2">yourselfâ€”either by hand, with paper and pencil, or with external plotting programs. </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">The DDD debugger has some visualization capabilities, and is freely available (see [URL </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">19]). It is interesting to note that DDD works with multiple languages, including Ada, C, </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">C++, Fortran, Java, Modula, Pascal, Perl, and Python (clearly an orthogonal design). </p>
    <p class="calibre_2">
      <span class="bold">Tracing</span>
    </p>
    <p class="calibre_2">Debuggers generally focus on the state of the program <span class="italic">now. </span> Sometimes you need</p>
    <p class="calibre_2">moreâ€”you need to watch the state of a program or a data structure over time. Seeing a</p>
    <p class="calibre_2">stack trace can only tell you how you got here directly. It can't tell you what you were doing</p>
    <p class="calibre_2">prior to this call chain, especially in event-based systems. </p>
    <p class="calibre_2"><span class="italic">Tracing statements</span> are those little diagnostic messages you print to the screen or to a file </p>
    <p class="calibre_2">that say things such as "got here" and "value of x = 2." It's a primitive technique compared </p>
    <p class="calibre_2">with IDE-style debuggers, but it is peculiarly effective at diagnosing several classes of </p>
    <p class="calibre_2">errors that debuggers can't. Tracing is invaluable in any system where time itself is a </p>
    <p class="calibre_2">factor: concurrent processes, real-time systems, and event-based applications. </p>
    <p class="calibre_2">You can use tracing statements to "drill down" into the code. That is, you can add tracing </p>
    <p class="calibre_2">statements as you descend the call tree. </p>
    <p class="calibre_2">Trace messages should be in a regular, consistent format; you may want to parse them </p>
    <p class="calibre_2">automatically. For instance, if you needed to track down a resource leak (such as </p>
    <p class="calibre_2">unbalanced file opens/closes), you could trace each open and each close in a log file. By </p>
    <p class="calibre_2">processing the log file with Perl, you could easily identify where the offending open was </p>
    <p class="calibre_2">occurring. </p>
    <p class="calibre_2">
      <span class="bold">Corrupt Variables? Check Their Neighborhood</span>
    </p>
    <p class="calibre_2">Sometimes you'll examine a variable, expecting to see a small integer value, and </p>
    <p class="calibre_2">instead get something like 0x6e69614d. Before you roll up your sleeves for some </p>
    <p class="calibre_2">serious debugging, have a quick look at the memory around this corrupted </p>
    <p class="calibre_2">variable. Often it will give you a clue. In our case, examining the surrounding </p>
    <p class="calibre_2">memory as characters shows us</p>
    <p class="calibre_2">20333231 6e69614d 2c745320 746f4e0a</p>
    <p class="calibre_2">1 2 3 M a i n S t , \n N o t</p>
    <p class="calibre_2">2c6e776f 2058580a 31323433 00000a33</p>
    <p class="calibre_2">o w n , \n x x 3 4 2 1 3\n\0\0</p>
    <p class="calibre_2">Looks like someone sprayed a street address over our counter. Now we know </p>
    <p class="calibre_2">where to look. </p>
    <p class="calibre_2">
      <span class="bold">Rubber Ducking</span>
    </p>
    <p class="calibre_2">A very simple but particularly useful technique for finding the cause of a problem is simply </p>
    <p class="calibre_2">to explain it to someone else. The other person should look over your shoulder at the </p>
    <p class="calibre_2">screen, and nod his or her head constantly (like a rubber duck bobbing up and down in a </p>
    <p class="calibre_2">bathtub). They do not need to say a word; the simple act of explaining, step by step, what </p>
    <p class="calibre_2">the code is supposed to do often causes the problem to leap off the screen and announce </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">itself.[7]</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">[7] Why "rubber ducking"? While an undergraduate at Imperial College in London, Dave did a lot of work</p>
    <p class="calibre_2">with a research assistant named Greg Pugh, one of the best developers Dave has known. For several </p>
    <p class="calibre_2">months Greg carried around a small yellow rubber duck, which he'd place on his terminal while coding. It </p>
    <p class="calibre_2">was a while before Dave had the courage to ask.... </p>
    <p class="calibre_2">It sounds simple, but in explaining the problem to another person you must explicitly state </p>
    <p class="calibre_2">things that you may take for granted when going through the code yourself. By having to </p>
    <p class="calibre_2">verbalize some of these assumptions, you may suddenly gain new insight into the problem. </p>
    <p class="calibre_2">
      <span class="bold">Process of Elimination</span>
    </p>
    <p class="calibre_2">In most projects, the code you are debugging may be a mixture of application code written </p>
    <p class="calibre_2">by you and others on your project team, third-party products (database, connectivity, </p>
    <p class="calibre_2">graphical libraries, specialized communications or algorithms, and so on) and the platform </p>
    <p class="calibre_2">environment (operating system, system libraries, and compilers). </p>
    <p class="calibre_2">It is possible that a bug exists in the OS, the compiler, or a third-party productâ€”but this</p>
    <p class="calibre_2">should not be your first thought. It is much more likely that the bug exists in the application</p>
    <p class="calibre_2">code under development. It is generally more profitable to assume that the application</p>
    <p class="calibre_2">code is incorrectly calling into a library than to assume that the library itself is broken. Even</p>
    <p class="calibre_2">if the problem <span class="italic">does</span> lie with a third party, you'll still have to eliminate your code before </p>
    <p class="calibre_2">submitting the bug report. </p>
    <p class="calibre_2">We worked on a project where a senior engineer was convinced that the select system call </p>
    <p class="calibre_2">was broken on Solaris. No amount of persuasion or logic could change his mind (the fact </p>
    <p class="calibre_2">that every other networking application on the box worked fine was irrelevant). He spent </p>
    <p class="calibre_2">weeks writing work-arounds, which, for some odd reason, didn't seem to fix the problem. </p>
    <p class="calibre_2">When finally forced to sit down and read the documentation on select, he discovered the </p>
    <p class="calibre_2">problem and corrected it in a matter of minutes. We now use the phrase "select is broken" </p>
    <p class="calibre_2">as a gentle reminder whenever one of us starts blaming the system for a fault that is likely </p>
    <p class="calibre_2">to be our own. </p>
    <p class="calibre_2">
      <span class="bold">Tip 26</span>
    </p>
    <p class="calibre_2">"select" Isn't Broken</p>
    <p class="calibre_2">Remember, if you see hoof prints, think horsesâ€”not zebras. The OS is probably not</p>
    <p class="calibre_2">broken. And the database is probably just fine. </p>
    <p class="calibre_2">If you "changed only one thing" and the system stopped working, that one thing was likely </p>
    <p class="calibre_2">to be responsible, directly or indirectly, no matter how farfetched it seems. Sometimes the </p>
    <p class="calibre_2">thing that changed is outside of your control: new versions of the OS, compiler, database, </p>
    <p class="calibre_2">or other third-party software can wreak havoc with previously correct code. New bugs </p>
    <p class="calibre_2">might show up. Bugs for which you had a work-around get fixed, breaking the work-around. </p>
    <p class="calibre_2">APIs change, functionality changes; in short, it's a whole new ball game, and you must </p>
    <p class="calibre_2">retest the system under these new conditions. So keep a close eye on the schedule when </p>
    <p class="calibre_2">considering an upgrade; you may want to wait until <span class="italic">after</span> the next release. </p>
    <p class="calibre_2">If, however, you have no obvious place to start looking, you can always rely on a good </p>
    <p class="calibre_2">old-fashioned binary search. See if the symptoms are present at either of two far away </p>
    <p class="calibre_2">spots in the code. Then look in the middle. If the problem is present, then the bug lies </p>
    <p class="calibre_2">between the start and the middle point; otherwise, it is between the middle point and the </p>
    <p class="calibre_2">end. You can continue in this fashion until you narrow down the spot sufficiently to identify </p>
    <p class="calibre_2">the problem. </p>
    <p class="calibre_2">
      <span class="bold">The Element of Surprise</span>
    </p>
    <p class="calibre_2">When you find yourself surprised by a bug (perhaps even muttering "that's impossible" </p>
    <p class="calibre_2">under your breath where we can't hear you), you must reevaluate truths you hold dear. In</p>
    <p class="calibre_2">that linked list routineâ€”the one you knew was bulletproof and couldn't possibly be the</p>
    <p class="calibre_2">cause of this bugâ€”did you test <span class="italic">all</span> the boundary conditions? That other piece of code</p>
    <p class="calibre_2">you've been using for yearsâ€”it couldn't possibly still have a bug in it. Could it? </p>
    <p class="calibre_2">Of course it can. The amount of surprise you feel when something goes wrong is directly </p>
    <p class="calibre_2">proportional to the amount of trust and faith you have in the code being run. That's why, </p>
    <p class="calibre_2">when faced with a "surprising" failure, you must realize that one or more of your </p>
    <p class="calibre_2">assumptions is wrong. Don't gloss over a routine or piece of code involved in the bug </p>
    <p class="calibre_2">because you "know" it works. Prove it. Prove it in <span class="italic">this</span> context, with this data, with <span class="italic">these</span></p>
    <p class="calibre_2">boundary conditions. </p>
    <p class="calibre_2">
      <span class="bold">Tip 27</span>
    </p>
    <p class="calibre_2">Don't Assume Itâ€”Prove It</p>
    <p class="calibre_2">When you come across a surprise bug, beyond merely fixing it, you need to determine why </p>
    <p class="calibre_2">this failure wasn't caught earlier. Consider whether you need to amend the unit or other </p>
    <p class="calibre_2">tests so that they would have caught it. </p>
    <p class="calibre_2">Also, if the bug is the result of bad data that was propagated through a couple of levels </p>
    <p class="calibre_2">before causing the explosion, see if better parameter checking in those routines would </p>
    <p class="calibre_2">have isolated it earlier (see the discussions on crashing early and assertions on pages 120 </p>
    <p class="calibre_2">and 122, respectively). </p>
    <p class="calibre_2">While you're at it, are there any other places in the code that may be susceptible to this </p>
    <p class="calibre_2">same bug? Now is the time to find and fix them. Make sure that <span class="italic">whatever</span> happened, you'll </p>
    <p class="calibre_2">know if it happens again. </p>
    <p class="calibre_2">If it took a long time to fix this bug, ask yourself why. Is there anything you can do to make </p>
    <p class="calibre_2">fixing this bug easier the next time around? Perhaps you could build in better testing hooks, </p>
    <p class="calibre_2">or write a log file analyzer. </p>
    <p class="calibre_2">Finally, if the bug is the result of someone's wrong assumption, discuss the problem with </p>
    <p class="calibre_2">the whole team: if one person misunderstands, then it's possible many people do. </p>
    <p class="calibre_2">Do all this, and hopefully you won't be surprised next time. </p>
    <p class="calibre_2">
      <span class="bold">Debugging Checklist</span>
    </p>
    <p class="calibre_2">Is the problem being reported a direct result of the underlying bug, or merely a </p>
    <p class="calibre_2">symptom? </p>
    <p class="calibre_2">Is the bug <span class="italic">really</span> in the compiler? Is it in the OS? Or is it in your code? </p>
    <p class="calibre_2">If you explained this problem in detail to a coworker, what would you say? </p>
    <p class="calibre_2">If the suspect code passes its unit tests, are the tests complete enough? What </p>
    <p class="calibre_2">happens if you run the unit test with <span class="italic">this</span> data? </p>
    <p class="calibre_2">Do the conditions that caused this bug exist anywhere else in the system? </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Assertive Programming</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Programming by Coincidence</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Ubiquitous Automation</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00291.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00135.jpg"/>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Ruthless Testing</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Debugging is challenge enough. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00037.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00204.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Text Manipulation</span>
    </p>
    <p class="calibre_2">Pragmatic Programmers manipulate text the same way woodworkers shape wood. In</p>
    <p class="calibre_2">previous sections we discussed some specific toolsâ€”shells, editors, debuggersâ€”that we</p>
    <p class="calibre_2">use. These are similar to a wood-worker's chisels, saws, and planesâ€”tools specialized to</p>
    <p class="calibre_2">do one or two jobs well. However, every now and then we need to perform some</p>
    <p class="calibre_2">transformation not readily handled by the basic tool set. We need a general-purpose text</p>
    <p class="calibre_2">manipulation tool. </p>
    <p class="calibre_2">Text manipulation languages are to programming what routers<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[8]</span></span></a> are to woodworking. They</p>
    <p class="calibre_2">are noisy, messy, and somewhat brute force. Make mistakes with them, and entire pieces </p>
    <p class="calibre_2">can be ruined. Some people swear they have no place in the toolbox. But in the right </p>
    <p class="calibre_2">hands, both routers and text manipulation languages can be incredibly powerful and </p>
    <p class="calibre_2">versatile. You can quickly trim something into shape, make joints, and carve. Used </p>
    <p class="calibre_2">properly, these tools have surprising finesse and subtlety. But they take time to master. </p>
    <p class="calibre_2">[8] Here <span class="italic">router</span> means the tool that spins cutting blades very, very fast, not a device for interconnecting </p>
    <p class="calibre_2">networks. </p>
    <p class="calibre_2">There is a growing number of good text manipulation languages. Unix developers often like </p>
    <p class="calibre_2">to use the power of their command shells, augmented with tools such as awk and sed. </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">People who prefer a more structured tool like the object-oriented nature of Python [URL 9]. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Some people use Tcl [URL 23</span>
        </span>
      </a>
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">] as their tool of choice. We happen to prefer Perl [URL 8] for </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">hacking out short scripts. </p>
    <p class="calibre_2">These languages are important enabling technologies. Using them, you can quickly hack</p>
    <p class="calibre_2">up utilities and prototype ideasâ€”jobs that might take five or ten times as long using</p>
    <p class="calibre_2">conventional languages. And that multiplying factor is crucially important to the kind of</p>
    <p class="calibre_2">experimenting that we do. Spending 30 minutes trying out a crazy idea is a whole lot better</p>
    <p class="calibre_2">that spending five hours. Spending a day automating important components of a project is</p>
    <p class="calibre_2">acceptable; spending a week might not be. In their book <span class="italic">The Practice of Programming</span></p>
    <p class="calibre_2"><span class="calibre_5"><span class="underline">[KP99</span></span>], Kernighan and Pike built the same program in five different languages. The Perl </p>
    <p class="calibre_2">version was the shortest (17 lines, compared with C's 150). With Perl you can manipulate </p>
    <p class="calibre_2">text, interact with programs, talk over networks, drive Web pages, perform arbitrary </p>
    <p class="calibre_2">precision arithmetic, and write programs that look like Snoopy swearing. </p>
    <p class="calibre_2">
      <span class="bold">Tip 28</span>
    </p>
    <p class="calibre_2">Learn a Text Manipulation Language</p>
    <p class="calibre_2">To show the wide-ranging applicability of text manipulation languages, here's a sample of </p>
    <p class="calibre_2">some applications we've developed over the last few years. </p>
    <p class="calibre_2"><span class="bold">Database schema maintenance. </span> A set of Perl scripts took a plain text file</p>
    <p class="calibre_2">containing a database schema definition and from it generated:</p>
    <p class="calibre_2">The SQL statements to create the database</p>
    <p class="calibre_2">Flat data files to populate a data dictionary</p>
    <p class="calibre_2">C code libraries to access the database</p>
    <p class="calibre_2">Scripts to check database integrity</p>
    <p class="calibre_2">Web pages containing schema descriptions and diagrams</p>
    <p class="calibre_2">An XML version of the schema</p>
    <p class="calibre_2"><span class="bold">Java property access. </span> It is good OO programming style to restrict access to an</p>
    <p class="calibre_2">object's properties, forcing external classes to get and set them via methods. </p>
    <p class="calibre_2">However, in the common case where a property is represented inside the class by </p>
    <p class="calibre_2">a simple member variable, creating a get and set method for each variable is </p>
    <p class="calibre_2">tedious and mechanical. We have a Perl script that modifies the source files and </p>
    <p class="calibre_2">inserts the correct method definitions for all appropriately flagged variables. </p>
    <p class="calibre_2"><span class="bold">Test data generation. </span> We had tens of thousands of records of test data, spread</p>
    <p class="calibre_2">over several different files and formats, that needed to be knitted together and </p>
    <p class="calibre_2">converted into a form suitable for loading into a relational database. Perl did it in a </p>
    <p class="calibre_2">couple of hours (and in the process found a couple of consistency errors in the </p>
    <p class="calibre_2">original data). </p>
    <p class="calibre_2"><span class="bold">Book writing. </span> We think it is important that any code presented in a book should</p>
    <p class="calibre_2">have been tested first. Most of the code in this book has been. However, using the </p>
    <p class="calibre_2"><span class="italic">DRY</span> principle (see <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">The Evils of Duplication</span></span></a>) we didn't want to copy and paste lines</p>
    <p class="calibre_2">of code from the tested programs into the book. That would have meant that the</p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00064.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00346.jpg"/>
    </p>
    <p class="calibre_2">code was duplicated, virtually guaranteeing that we'd forget to update an example</p>
    <p class="calibre_2">when the corresponding program was changed. For some examples, we also didn't</p>
    <p class="calibre_2">want to bore you with all the framework code needed to make our example compile</p>
    <p class="calibre_2">and run. We turned to Perl. A relatively simple script is invoked when we format the</p>
    <p class="calibre_2">bookâ€”it extracts a named segment of a source file, does syntax highlighting, and</p>
    <p class="calibre_2">converts the result into the typesetting language we use. </p>
    <p class="calibre_2"><span class="bold">C to Object Pascal interface. </span> A client had a team of developers writing Object</p>
    <p class="calibre_2">Pascal on PCs. Their code needed to interface to a body of code written in C. We </p>
    <p class="calibre_2">developed a short Perl script that parsed the C header files, extracting the </p>
    <p class="calibre_2">definitions of all exported functions and the data structures they used. We then </p>
    <p class="calibre_2">generated Object Pascal units with Pascal records for all the C structures, and </p>
    <p class="calibre_2">imported procedure definitions for all the C functions. This generation process </p>
    <p class="calibre_2">became part of the build, so that whenever the C header changed, a new Object </p>
    <p class="calibre_2">Pascal unit would be constructed automatically. </p>
    <p class="calibre_2"><span class="bold">Generating Web documentation. </span> Many project teams are publishing their</p>
    <p class="calibre_2">documentation to internal Web sites. We have written many Perl programs that </p>
    <p class="calibre_2">analyze database schemas, C or C++ source files, makefiles, and other project </p>
    <p class="calibre_2">sources to produce the required HTML documentation. We also use Perl to wrap </p>
    <p class="calibre_2">the documents with standard headers and footers, and to transfer them to the Web </p>
    <p class="calibre_2">site. </p>
    <p class="calibre_2">We use text manipulation languages almost every day. Many of the ideas in this book can </p>
    <p class="calibre_2">be implemented more simply in them than in any other language of which we're aware. </p>
    <p class="calibre_2">These languages make it easy to write code generators, which we'll look at next. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">The Evils of Duplication</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00231.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00194.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <span class="bold">11. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Your C program uses an enumerated type to represent one of 100 states. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">You'd like to be able to print out the state as a string (as opposed to a </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">number) for debugging purposes. Write a script that reads from standard input </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">a file containing</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">name</p>
    <p class="calibre_2">state_a</p>
    <p class="calibre_2">state_b</p>
    <p class="calibre_2">: :</p>
    <p class="calibre_2">Produce the file <span class="italic">name.h, </span> which contains</p>
    <p class="calibre_2"><span class="bold">extern const char</span>* NAME_names[]; </p>
    <p class="calibre_2"><span class="bold">typedef enum</span> {</p>
    <p class="calibre_2">state_a, </p>
    <p class="calibre_2">state_b, </p>
    <p class="calibre_2">: :</p>
    <p class="calibre_2">} NAME; </p>
    <p class="calibre_2">and the file <span class="italic">name.c, </span> which contains</p>
    <p class="calibre_2"><span class="bold">const char</span>* NAME_names[] = {</p>
    <p class="calibre_2">
      <span class="italic">"state_a", </span>
    </p>
    <p class="calibre_2">
      <span class="italic">"state_b", </span>
    </p>
    <p class="calibre_2">: :</p>
    <p class="calibre_2">}; </p>
    <p class="calibre_2">
      <span class="bold">12. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Halfway through writing this book, we realized that we hadn't put the use strict</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">directive into many of our Perl examples. Write a script that goes through the </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00217.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00009.jpg"/>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">.p1 flies in a directory and adds a use strict at the end of the initial comment </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">block to all flies that don't already have one. Remember to keep a backup of </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">all flies you change . </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00066.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00305.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Code Generators</span>
    </p>
    <p class="calibre_2">When woodworkers are faced with the task of producing the same thing over and over, </p>
    <p class="calibre_2">they cheat. They build themselves a jig or a template. If they get the jig right once, they can </p>
    <p class="calibre_2">reproduce a piece of work time after time. The jig takes away complexity and reduces the </p>
    <p class="calibre_2">chances of making mistakes, leaving the craftsman free to concentrate on quality. </p>
    <p class="calibre_2">As programmers, we often find ourselves in a similar position. We need to achieve the </p>
    <p class="calibre_2">same functionality, but in different contexts. We need to repeat information in different </p>
    <p class="calibre_2">places. Sometimes we just need to protect ourselves from carpal tunnel syndrome by </p>
    <p class="calibre_2">cutting down on repetitive typing. </p>
    <p class="calibre_2">In the same way a woodworker invests the time in a jig, a programmer can build a code </p>
    <p class="calibre_2">generator. Once built, it can be used throughout the life of the project at virtually no cost. </p>
    <p class="calibre_2">
      <span class="bold">Tip 29</span>
    </p>
    <p class="calibre_2">Write Code That Writes Code</p>
    <p class="calibre_2">There are two main types of code generators:</p>
    <p class="calibre_2">1. <span class="italic">Passive code generators</span> are run once to produce a result. From that point</p>
    <p class="calibre_2">forward, the result becomes freestandingâ€”it is divorced from the code generator. </p>
    <p class="calibre_2">The wizards discussed in <span class="italic">Evil Wizards, </span> along with some CASE tools, are examples </p>
    <p class="calibre_2">of passive code generators. </p>
    <p class="calibre_2">2. <span class="italic">Active code generators</span> are used each time their results are required. The result is</p>
    <p class="calibre_2">a throw-awayâ€”it can always be reproduced by the code generator. Often, active</p>
    <p class="calibre_2">code generators read some form of script or control file to produce their results. </p>
    <p class="calibre_2">
      <span class="bold">Passive Code Generators</span>
    </p>
    <p class="calibre_2">Passive code generators save typing. They are basically parameterized templates, </p>
    <p class="calibre_2">generating a given output from a set of inputs. Once the result is produced, it becomes a </p>
    <p class="calibre_2">full-fledged source file in the project; it will be edited, compiled, and placed under source </p>
    <p class="calibre_2">control just like any other file. Its origins will be forgotten. </p>
    <p class="calibre_2">Passive code generators have many uses:</p>
    <p class="calibre_2"><span class="italic">Creating new source files. </span> A passive code generator can produce templates, </p>
    <p class="calibre_2">source code control directives, copyright notices, and standard comment blocks for </p>
    <p class="calibre_2">each new file in a project. We have our editors set up to do this whenever we </p>
    <p class="calibre_2">create a new file: edit a new Java program, and the new editor buffer will </p>
    <p class="calibre_2">automatically contain a comment block, package directive, and the outline class </p>
    <p class="calibre_2">declaration, already filled in. </p>
    <p class="calibre_2"><span class="italic">Performing one-off conversions</span> among programming languages. We started </p>
    <p class="calibre_2">writing this book using the troff system, but we switched to LaTeXafter 15 sections </p>
    <p class="calibre_2">had been completed. We wrote a code generator that read the troff source and </p>
    <p class="calibre_2">converted it to LaTeX. It was about 90% accurate; the rest we did by hand. This is </p>
    <p class="calibre_2">an interesting feature of passive code generators: they don't have to be totally </p>
    <p class="calibre_2">accurate. You get to choose how much effort you put into the generator, compared </p>
    <p class="calibre_2">with the energy you spend fixing up its output. </p>
    <p class="calibre_2"><span class="italic">Producing lookup tables and other resources</span> that are expensive to compute at </p>
    <p class="calibre_2">runtime. Instead of calculating trigonometric functions, many early graphics </p>
    <p class="calibre_2">systems used precomputed tables of sine and cosine values. Typically, these </p>
    <p class="calibre_2">tables were produced by a passive code generator and then copied into the source. </p>
    <p class="calibre_2">
      <span class="bold">Active Code Generators</span>
    </p>
    <p class="calibre_2">While passive code generators are simply a convenience, their active cousins are a </p>
    <p class="calibre_2">necessity if you want to follow the <span class="italic">DRY</span> principle. With an active code generator, you can </p>
    <p class="calibre_2">take a single representation of some piece of knowledge and convert it into all the forms </p>
    <p class="calibre_2">your application needs. This <span class="italic">is not</span> duplication, because the derived forms are disposable, </p>
    <p class="calibre_2">and are generated as needed by the code generator (hence the word <span class="italic">active</span>) <span class="italic">. </span></p>
    <p class="calibre_2">Whenever you find yourself trying to get two disparate environments to work together, you </p>
    <p class="calibre_2">should consider using active code generators. </p>
    <p class="calibre_2">Perhaps you're developing a database application. Here, you're dealing with two</p>
    <p class="calibre_2">environmentsâ€”the database and the programming language you are using to access it. </p>
    <p class="calibre_2">
      <img class="calibre_22" src="images/00125.jpg"/>
    </p>
    <p class="calibre_2">You have a schema, and you need to define low-level structures mirroring the layout of</p>
    <p class="calibre_2">certain database tables. You could just code these directly, but this violates the <span class="italic">DRY</span></p>
    <p class="calibre_2">principle: knowledge of the schema would then be expressed in two places. When the </p>
    <p class="calibre_2">schema changes, you need to remember to change the corresponding code. If a column is </p>
    <p class="calibre_2">removed from a table, but the code base is not changed, you might not even get a </p>
    <p class="calibre_2">compilation error. The first you'll know about it is when your tests start failing (or when the </p>
    <p class="calibre_2">user calls). </p>
    <p class="calibre_2">An alternative is to use an active code generatorâ€”take the schema and use it to generate</p>
    <p class="calibre_2">the source code for the structures, as shown in<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline"> Figure 3.3</span></span></a>. Now, whenever the schema </p>
    <p class="calibre_2">changes, the code used to access it also changes, automatically. If a column is removed, </p>
    <p class="calibre_2">then its corresponding field in the structure will disappear, and any higher-level code that </p>
    <p class="calibre_2">uses that column will fail to compile. You've caught the error at compile time, not in </p>
    <p class="calibre_2">production. Of course, this scheme works only if you make the code generation part of the </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">build process itself.[9]</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">[9] Just <span class="italic">how</span> do you go about building code from a database schema? There are several ways. If the </p>
    <p class="calibre_2">schema is held in a flat file (for example, as create table statements), then a relatively simple script can </p>
    <p class="calibre_2">parse it and generate the source. Alternatively, if you use a tool to create the schema directly in the </p>
    <p class="calibre_2">database, then you should be able to extract the information you need directly from the database's data </p>
    <p class="calibre_2">dictionary. Perl provides libraries that give you access to most major databases. </p>
    <p class="calibre_2">
      <span class="bold">Figure 3.3. Active code generator creates code from a database schema</span>
    </p>
    <p class="calibre_2">Another example of melding environments using code generators happens when different</p>
    <p class="calibre_2">programming languages are used in the same application. In order to communicate, each</p>
    <p class="calibre_2">code base will need some information in commonâ€”data structures, message formats, and</p>
    <p class="calibre_2">field names, for example. Rather than duplicate this information, use a code generator. </p>
    <p class="calibre_2">Sometimes you can parse the information out of the source files of one language and use it</p>
    <p class="calibre_2">to generate code in a second language. Often, though, it is simpler to express it in a</p>
    <p class="calibre_2">simpler, language-neutral representation and generate the code for both languages, as</p>
    <p class="calibre_2">shown in <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Figure 3.4 on the following page. Also see the answer to Exercise 13 on page </span></span></a></p>
    <p class="calibre_2">286 for an example of how to separate the parsing of the flat file representation from code </p>
    <p class="calibre_2">
      <img class="calibre_23" src="images/00241.jpg"/>
    </p>
    <p class="calibre_2">generation. </p>
    <p class="calibre_2">
      <span class="bold">Figure 3.4. Generating code from a language-neutral representation. In the input file, lines </span>
    </p>
    <p class="calibre_2">
      <span class="bold">starting with 'M' flag the start of a message definition, 'F' lines define fields, and 'E' is the end </span>
    </p>
    <p class="calibre_2">
      <span class="bold">of the message. </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Code Generators Needn't Be Complex</span>
    </p>
    <p class="calibre_2">All this talk of <span class="italic">active</span> this and <span class="italic">passive</span> that may leave you with the impression that code </p>
    <p class="calibre_2">generators are complex beasts. They needn't be. Normally the most complex part is the </p>
    <p class="calibre_2">parser, which analyzes the input file. Keep the input format simple, and the code generator </p>
    <p class="calibre_2">becomes simple. Have a look at the answer to Exercise 13 (page 286): the actual code </p>
    <p class="calibre_2">generation is basically print statements. </p>
    <p class="calibre_2">
      <span class="bold">Code Generators Needn't Generate Code</span>
    </p>
    <p class="calibre_2">Although many of the examples in this section show code generators that produce</p>
    <p class="calibre_2">program source, this needn't always be the case. You can use code generators to write</p>
    <p class="calibre_2">just about any output: HTML, XML, plain textâ€”any text that might be an input somewhere</p>
    <p class="calibre_2">else in your project. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00320.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00085.jpg"/>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">The Evils of Duplication</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">The Power of Plain Text</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Evil Wizards</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Ubiquitous Automation</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <span class="bold">13. </span>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Write a code generator that takes the input file in </span></span></a><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Figure 3.4</span></span></a>, and generates </p>
    <p class="calibre_2">output in two languages of your choice. Try to make it easy to add new </p>
    <p class="calibre_2">languages <span class="italic">. </span></p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00020.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00116.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Chapter 4. Pragmatic Paranoia</span>
    </p>
    <p class="calibre_2">
      <span class="bold">Tip 30</span>
    </p>
    <p class="calibre_2">You Can't Write Perfect Software</p>
    <p class="calibre_2">Did that hurt? It shouldn't. Accept it as an axiom of life. Embrace it. Celebrate it. Because </p>
    <p class="calibre_2">perfect software doesn't exist. No one in the brief history of computing has ever written a </p>
    <p class="calibre_2">piece of perfect software. It's unlikely that you'll be the first. And unless you accept this as a </p>
    <p class="calibre_2">fact, you'll end up wasting time and energy chasing an impossible dream. </p>
    <p class="calibre_2">So, given this depressing reality, how does a Pragmatic Programmer turn it into an </p>
    <p class="calibre_2">advantage? That's the topic of this chapter. </p>
    <p class="calibre_2">Everyone knows that they personally are the only good driver on Earth. The rest of the </p>
    <p class="calibre_2">world is out there to get them, blowing through stop signs, weaving between lanes, not </p>
    <p class="calibre_2">indicating turns, talking on the telephone, reading the paper, and just generally not living up </p>
    <p class="calibre_2">to our standards. So we drive defensively. We look out for trouble before it happens, </p>
    <p class="calibre_2">anticipate the unexpected, and never put ourselves into a position from which we can't </p>
    <p class="calibre_2">extricate ourselves. </p>
    <p class="calibre_2">The analogy with coding is pretty obvious. We are constantly interfacing with other people's</p>
    <p class="calibre_2">codeâ€”code that might not live up to our high standardsâ€”and dealing with inputs that may</p>
    <p class="calibre_2">or may not be valid. So we are taught to code defensively. If there's any doubt, we validate</p>
    <p class="calibre_2">all information we're given. We use assertions to detect bad data. We check for</p>
    <p class="calibre_2">consistency, put constraints on database columns, and generally feel pretty good about</p>
    <p class="calibre_2">ourselves. </p>
    <p class="calibre_2">But Pragmatic Programmers take this a step further. <span class="italic">They don't trust themselves, either. </span></p>
    <p class="calibre_2">Knowing that no one writes perfect code, including themselves, Pragmatic Programmers </p>
    <p class="calibre_2">code in defenses against their own mistakes. We describe the first defensive measure in </p>
    <p class="calibre_2"><span class="italic">Design by Contract:</span> clients and suppliers must agree on rights and responsibilities. </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00107.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00203.jpg"/>
    </p>
    <p class="calibre_2">In <span class="italic">Dead Programs Tell No Lies, </span> we want to ensure that we do no damage while we're </p>
    <p class="calibre_2">working the bugs out. So we try to check things often and terminate the program if things </p>
    <p class="calibre_2">go awry. </p>
    <p class="calibre_2"><span class="italic">Assertive Programming</span> describes an easy method of checking along the wayâ€”write code</p>
    <p class="calibre_2">that actively verifies your assumptions. </p>
    <p class="calibre_2">Exceptions, like any other technique, can cause more harm than good if not used properly. </p>
    <p class="calibre_2">We'll discuss the issues in <span class="italic">When to Use Exceptions. </span></p>
    <p class="calibre_2">As your programs get more dynamic, you'll find yourself juggling system</p>
    <p class="calibre_2">resourcesâ€”memory, files, devices, and the like. In <span class="italic">How to Balance Resources, </span> we'll </p>
    <p class="calibre_2">suggest ways of ensuring that you don't drop any of the balls. </p>
    <p class="calibre_2">In a world of imperfect systems, ridiculous time scales, laughable tools, and impossible </p>
    <p class="calibre_2">requirements, let's play it safe. </p>
    <p class="calibre_2">
      <span class="italic">When everybody actually is out to get you, paranoia is just good thinking. </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Woody Alien</span>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00208.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00083.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Design by Contract</span>
    </p>
    <p class="calibre_2">
      <span class="italic">Nothing astonishes men so much as common sense and plain dealing. </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Ralph Waldo Emerson, </span>
      <span class="italic">
        <span class="bold">Essays</span>
      </span>
    </p>
    <p class="calibre_2">Dealing with computer systems is hard. Dealing with people is even harder. But as a </p>
    <p class="calibre_2">species, we've had longer to figure out issues of human interactions. Some of the solutions </p>
    <p class="calibre_2">we've come up with during the last few millennia can be applied to writing software as well. </p>
    <p class="calibre_2">One of the best solutions for ensuring plain dealing is the <span class="italic">contract. </span></p>
    <p class="calibre_2">A contract defines your rights and responsibilities, as well as those of the other party. In </p>
    <p class="calibre_2">addition, there is an agreement concerning repercussions if either party fails to abide by </p>
    <p class="calibre_2">the contract. </p>
    <p class="calibre_2">Maybe you have an employment contract that specifies the hours you'll work and the rules </p>
    <p class="calibre_2">of conduct you must follow. In return, the company pays you a salary and other perks. </p>
    <p class="calibre_2">Each party meets its obligations and everyone benefits. </p>
    <p class="calibre_2">It's an idea used the world overâ€”both formally and informallyâ€”to help humans interact. </p>
    <p class="calibre_2">Can we use the same concept to help software modules interact? The answer is "yes." </p>
    <p class="calibre_2">
      <span class="bold">DBC</span>
    </p>
    <p class="calibre_2"><span class="calibre_5"><span class="underline">Bertrand Meyer [Mey97b</span></span>] developed the concept of <span class="italic">Design by Contract</span> for the language </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Eiffel.[1] It is a simple yet powerful technique that focuses on documenting (and agreeing to</span></span></a>)</p>
    <p class="calibre_2">the rights and responsibilities of software modules to ensure program correctness. What is </p>
    <p class="calibre_2">a correct program? One that does no more and no less than it claims to do. Documenting </p>
    <p class="calibre_2">and verifying that claim is the heart of <span class="italic">Design by Contract</span> (DBC, for short). </p>
    <p class="calibre_2">[1] Based in part on earlier work by Dijkstra, Floyd, Hoare, Wirth, and others. For more information on</p>
    <p class="calibre_2">Eiffel itself, see [<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">URL 10] and [URL 11]. </span></span></a></p>
    <p class="calibre_2">Every function and method in a software system <span class="italic">does something. </span> Before it starts that </p>
    <p class="calibre_2"><span class="italic">something, </span> the routine may have some expectation of the state of the world, and it may be </p>
    <p class="calibre_2">able to make a statement about the state of the world when it concludes. Meyer describes </p>
    <p class="calibre_2">these expectations and claims as follows:</p>
    <p class="calibre_2"><span class="bold">Preconditions. </span> What must be true in order for the routine to be called; the</p>
    <p class="calibre_2">routine's requirements. A routine should never get called when its preconditions </p>
    <p class="calibre_2">would be violated. It is the caller's responsibility to pass good data (see the box on </p>
    <p class="calibre_2">page 115). </p>
    <p class="calibre_2"><span class="bold">Postconditions. </span> What the routine is guaranteed to do; the state of the world</p>
    <p class="calibre_2">when the routine is done. The fact that the routine has a postcondition implies that </p>
    <p class="calibre_2">it <span class="italic">will</span> conclude: infinite loops aren't allowed. </p>
    <p class="calibre_2"><span class="bold">Class invariants. </span> A class ensures that this condition is always true from the</p>
    <p class="calibre_2">perspective of a caller. During internal processing of a routine, the invariant may not </p>
    <p class="calibre_2">hold, but by the time the routine exits and control returns to the caller, the invariant </p>
    <p class="calibre_2">must be true. (Note that a class cannot give unrestricted write-access to any data </p>
    <p class="calibre_2">member that participates in the invariant.)</p>
    <p class="calibre_2">Let's look at the contract for a routine that inserts a data value into a unique, ordered list. In </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">iContract, a preprocessor for Java available from [URL 17</span></span></a>], you'd specify it as</p>
    <p class="calibre_2">/**</p>
    <p class="calibre_2">* <span class="italic">@invariant forall Node n in elements() |</span></p>
    <p class="calibre_2">* <span class="italic">n.prev() != null</span></p>
    <p class="calibre_2">* <span class="italic">implies</span></p>
    <p class="calibre_2">* <span class="italic">n.value().compare To(n.prev().value()) &gt; 0</span></p>
    <p class="calibre_2">*/</p>
    <p class="calibre_2"><span class="bold">public class</span> dbc_list {</p>
    <p class="calibre_2">/**</p>
    <p class="calibre_2">* <span class="italic">@pre contains(aNode) == false</span></p>
    <p class="calibre_2">* <span class="italic">@post contains(aNode) == true</span></p>
    <p class="calibre_2">*/</p>
    <p class="calibre_2"><span class="bold">public void</span> insertNode(<span class="bold">final</span> Node aNode) {</p>
    <p class="calibre_2">// ... </p>
    <p class="calibre_2">Here we are saying that nodes in this list must always be in increasing order. When you </p>
    <p class="calibre_2">insert a new node, it can't exist already, and we guarantee that the node will be found after </p>
    <p class="calibre_2">you have inserted it. </p>
    <p class="calibre_2">You write these preconditions, postconditions, and invariants in the target programming</p>
    <p class="calibre_2">language, perhaps with some extensions. For example, iContract provides predicate logic</p>
    <p class="calibre_2">operatorsâ€”forall, exists, and impliesâ€”in addition to normal Java constructs. Your</p>
    <p class="calibre_2">assertions can query the state of any object that the method can access, but be sure that</p>
    <p class="calibre_2">the query is free from any side effects (see page 124). </p>
    <p class="calibre_2">
      <span class="bold">DBC and Constant Parameters</span>
    </p>
    <p class="calibre_2">Often, a postcondition will use parameters passed into a method to verify correct </p>
    <p class="calibre_2">behavior. But if the routine is allowed to change the parameter that's passed in, </p>
    <p class="calibre_2">you might be able to circumvent the contract. Eiffel doesn't allow this to happen, </p>
    <p class="calibre_2">but Java does. Here, we use the Java keyword final to indicate our intentions</p>
    <p class="calibre_2">that the parameter shouldn't be changed within the method. This isn't</p>
    <p class="calibre_2">foolproofâ€“subclasses are free to redeclare the parameter as non-final. </p>
    <p class="calibre_2">Alternatively, you can use the iContract syntax <span class="italic">variable</span>@pre to get the original </p>
    <p class="calibre_2">value of the variable as it existed on entry to the method. </p>
    <p class="calibre_2">The contract between a routine and any potential caller can thus be read as</p>
    <p class="calibre_2">
      <span class="italic">If all the routine's preconditions are met by the caller, the routine shall </span>
    </p>
    <p class="calibre_2">
      <span class="italic">guarantee that all postconditions and invariants will be true when it </span>
    </p>
    <p class="calibre_2">
      <span class="italic">completes. </span>
    </p>
    <p class="calibre_2">If either party fails to live up to the terms of the contract, then a remedy (which was</p>
    <p class="calibre_2">previously agreed to) is invokedâ€”an exception is raised, or the program terminates, for</p>
    <p class="calibre_2">instance. Whatever happens, make no mistake that failure to live up to the contract is a</p>
    <p class="calibre_2">bug. It is not something that should ever happen, which is why preconditions should not be</p>
    <p class="calibre_2">used to perform things such as user-input validation. </p>
    <p class="calibre_2">
      <span class="bold">Tip 31</span>
    </p>
    <p class="calibre_2">Design with Contracts</p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">In Orthogonality</span></span></a>, we recommended writing "shy" code. Here, the emphasis is on "lazy" </p>
    <p class="calibre_2">code: be strict in what you will accept before you begin, and promise as little as possible in </p>
    <p class="calibre_2">return. Remember, if your contract indicates that you'll accept anything and promise the </p>
    <p class="calibre_2">world in return, then you've got a lot of code to write! </p>
    <p class="calibre_2">Inheritance and polymorphism are the cornerstones of object-oriented languages and an </p>
    <p class="calibre_2">area where contracts can really shine. Suppose you are using inheritance to create an </p>
    <p class="calibre_2">"is-a-kind-of" relationship, where one class "is-a-kind-of" another class. You probably want </p>
    <p class="calibre_2">to adhere to the <span class="italic">Liskov Substitution Principle</span><span class="calibre_5"><span class="underline"> [Lis88</span></span>]:</p>
    <p class="calibre_2">
      <span class="italic">Subclasses must be usable through the base class interface without the </span>
    </p>
    <p class="calibre_2">
      <span class="italic">need for the user to know the difference. </span>
    </p>
    <p class="calibre_2">In other words, you want to make sure that the new subtype you have created really</p>
    <p class="calibre_2">"is-a-klnd-of" the base typeâ€”that it supports the same methods, and that the methods</p>
    <p class="calibre_2">have the same meaning. We can do this with contracts. We need to specify a contract only</p>
    <p class="calibre_2">once, in the base class, to have it applied to every future subclass automatically. A</p>
    <p class="calibre_2">subclass may, optionally, accept a wider range of input, or make stronger guarantees. But</p>
    <p class="calibre_2">it must accept at least as much, and guarantee as much, as its parent. </p>
    <p class="calibre_2">For example, consider the Java base class java.awt.Component. You can treat any visual </p>
    <p class="calibre_2">component in AWT or Swing as a Component, without knowing that the actual subclass is </p>
    <p class="calibre_2">a button, a canvas, a menu, or whatever. Each individual component can provide </p>
    <p class="calibre_2">additional, specific functionality, but it has to provide at least the basic capabilities defined </p>
    <p class="calibre_2">by Component. But there's nothing to prevent you from creating a subtype of Component</p>
    <p class="calibre_2">that provides correctly named methods that do the wrong thing. You can easily create a </p>
    <p class="calibre_2">paint method that doesn't paint, or a setFont method that doesn't set the font. AWT doesn't </p>
    <p class="calibre_2">have contracts to catch the fact that you didn't live up to the agreement. </p>
    <p class="calibre_2">Without a contract, all the compiler can do is ensure that a subclass conforms to a </p>
    <p class="calibre_2">particular method signature. But if we put a base class contract in place, we can now </p>
    <p class="calibre_2">ensure that any future subclass can't alter the <span class="italic">meanings</span> of our methods. For instance, you </p>
    <p class="calibre_2">might want to establish a contract for setFont such as the following, which ensures that the </p>
    <p class="calibre_2">font you set is the font you get:</p>
    <p class="calibre_2">/**</p>
    <p class="calibre_2">* <span class="italic">@pre f != null</span></p>
    <p class="calibre_2">* <span class="italic">@post getFont()</span> == <span class="italic">f</span></p>
    <p class="calibre_2">*/</p>
    <p class="calibre_2"><span class="bold">public void</span> setFont(<span class="bold">final</span> Font f) {</p>
    <p class="calibre_2">// ... </p>
    <p class="calibre_2">
      <span class="bold">Implementing DBC</span>
    </p>
    <p class="calibre_2">The greatest benefit of using DBC may be that it forces the issue of requirements and</p>
    <p class="calibre_2">guarantees to the forefront. Simply enumerating at design time what the input domain</p>
    <p class="calibre_2">range is, what the boundary conditions are, and what the routine promises to deliverâ€”or, </p>
    <p class="calibre_2">more importantly, what it <span class="italic">doesn't</span> promise to deliverâ€”is a huge leap forward in writing</p>
    <p class="calibre_2">better software. By not stating these things, you are back to <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">programming by coincidence</span></span></a>, </p>
    <p class="calibre_2">which is where many projects start, finish, and fail. </p>
    <p class="calibre_2">In languages that do not support DBC in the code, this might be as far as you can goâ€”and</p>
    <p class="calibre_2">that's not too bad. DBC is, after all, a <span class="italic">design</span> technique. Even without automatic checking, </p>
    <p class="calibre_2">you can put the contract in the code as comments and still get a very real benefit. If nothing </p>
    <p class="calibre_2">else, the commented contracts give you a place to start looking when trouble strikes. </p>
    <p class="calibre_2">
      <span class="bold">Assertions</span>
    </p>
    <p class="calibre_2">While documenting these assumptions is a great start, you can get much greater benefit by </p>
    <p class="calibre_2">having the compiler check your contract for you. You can partially emulate this in some </p>
    <p class="calibre_2">languages by using <span class="italic">assertions</span> (see <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Assertive Programming</span></span></a>). Why only partially? Can't </p>
    <p class="calibre_2">you use assertions to do everything DBC can do? </p>
    <p class="calibre_2">Unfortunately, the answer is no. To begin with, there is no support for propagating </p>
    <p class="calibre_2">assertions down an inheritance hierarchy. This means that if you override a base class </p>
    <p class="calibre_2">method that has a contract, the assertions that implement that contract will not be called </p>
    <p class="calibre_2">correctly (unless you duplicate them manually in the new code). You must remember to call </p>
    <p class="calibre_2">the class invariant (and all base class invariants) manually before you exit every method. </p>
    <p class="calibre_2">The basic problem is that the contract is not automatically enforced. </p>
    <p class="calibre_2">Also, there is no built-in concept of "old" values; that is, values as they existed at the entry </p>
    <p class="calibre_2">to a method. If you're using assertions to enforce contracts, you must add code to the </p>
    <p class="calibre_2">precondition to save any information you'll want to use in the postcondition. Compare this </p>
    <p class="calibre_2">with iContract, where the postcondition can just reference " <span class="italic">Variable</span>@pre," or with Eiffel, </p>
    <p class="calibre_2">which supports "old <span class="italic">expression</span>." </p>
    <p class="calibre_2">Finally, the runtime system and libraries are not designed to support contracts, so these </p>
    <p class="calibre_2">calls are not checked. This is a big loss, because it is often at the boundary between your </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">code and the libraries it uses that the most problems are detected (see Dead Programs </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Tell No Lies for a more detailed discussion). </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Language Support</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Languages that feature built-in support of DBC (such as Eiffel and Sather [URL 12]) check </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">pre- and postconditions automatically in the compiler and runtime system. You get the </p>
    <p class="calibre_2">greatest benefit in this case because <span class="italic">all</span> of the code base (libraries, too) must honor their </p>
    <p class="calibre_2">contracts. </p>
    <p class="calibre_2">But what about more popular languages such as C, C++, and Java? For these languages, </p>
    <p class="calibre_2">there are preprocessors that process contracts embedded in the original source code as </p>
    <p class="calibre_2">special comments. The preprocessor expands these comments to code that verifies the </p>
    <p class="calibre_2">assertions. </p>
    <p class="calibre_2">For C and C++, you may want to investigate Nana<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline"> [URL 18]. </span></span></a>Nana doesn't handle </p>
    <p class="calibre_2">inheritance, but it does use the debugger at runtime to monitor assertions in a novel way. </p>
    <p class="calibre_2">For Java, there is iContract [<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">URL 17</span></span></a>]. It takes comments (in JavaDoc form) and generates </p>
    <p class="calibre_2">a new source file with the assertion logic included. </p>
    <p class="calibre_2">Preprocessors aren't as good as a built-in facility. They can be messy to integrate into your</p>
    <p class="calibre_2">project, and other libraries you use won't have contracts. But they can still be very helpful; </p>
    <p class="calibre_2">when a problem is discovered this wayâ€”especially one that you would <span class="italic">never</span> have</p>
    <p class="calibre_2">foundâ€”it's almost like magic. </p>
    <p class="calibre_2">
      <span class="bold">DBC and Crashing Early</span>
    </p>
    <p class="calibre_2">DBC fits in nicely with our concept of crashing early (see <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Dead Programs Tell No Lies</span></span></a>). </p>
    <p class="calibre_2">Suppose you have a method that calculates square roots (such as in the Eiffel class </p>
    <p class="calibre_2">DOUBLE). It needs a precondition that restricts the domain to positive numbers. An Eiffel </p>
    <p class="calibre_2">precondition is declared with the keyword require, and a postcondition is declared with </p>
    <p class="calibre_2">ensure, so you could write</p>
    <p class="calibre_2">sqrt: DOUBLE <span class="bold">is</span></p>
    <p class="calibre_2">-- <span class="italic">Square root routine</span></p>
    <p class="calibre_2">
      <span class="bold">require</span>
    </p>
    <p class="calibre_2">sqrt_arg_must_be_positive: Current &gt;= 0; </p>
    <p class="calibre_2">--- ... </p>
    <p class="calibre_2">--- <span class="italic">calculate square root here</span></p>
    <p class="calibre_2">--- ... </p>
    <p class="calibre_2">
      <span class="bold">ensure</span>
    </p>
    <p class="calibre_2">((Result*Result) - Current).abs &lt;= epsilon*Current.abs; </p>
    <p class="calibre_2">-- <span class="italic">Result should</span> be <span class="italic">within error tolerance</span></p>
    <p class="calibre_2">
      <span class="bold">end; </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Who's responsible? </span>
    </p>
    <p class="calibre_2">Who is repondible for cheeking the precondition, the caller or the routine being </p>
    <p class="calibre_2">called? when implemented as part of the language, the answer is neither: the </p>
    <p class="calibre_2">routine but before the routine itself is entered. Thus if there is any explicit </p>
    <p class="calibre_2">checking of parameters to be done, it must be performed by the <span class="italic">caller, </span> because </p>
    <p class="calibre_2">the routine itself will never see parameters that violate its precondition. (For </p>
    <p class="calibre_2">languages without built-in support, you would need to bracket the <span class="italic">called</span> routine </p>
    <p class="calibre_2">with a preamble and/or postamble that checks these assertions.)</p>
    <p class="calibre_2">Consider a program that reads a number from the console, calculate its square </p>
    <p class="calibre_2">root (by calling sqrt), and prints the result. The sqrt function has a</p>
    <p class="calibre_2">preconditionâ€”its argument must not be negative. If the user enters a negative</p>
    <p class="calibre_2">number at the console, it is up to the calling code to ensure that it never gets</p>
    <p class="calibre_2">passed to sqrt. This calling code has many options: it could terminate, it could </p>
    <p class="calibre_2">issue a warning and read another number, or it could make the number postive </p>
    <p class="calibre_2">and append an " <span class="italic">i</span>" to the result returned by sqrt. Whater its choice, this is </p>
    <p class="calibre_2">definitely not sqrt's problem. </p>
    <p class="calibre_2">By expressing the domain of the square root function in the precondition of the </p>
    <p class="calibre_2">sqrt routine, you shift the burden of correctness to the callâ€”where it belongs. you</p>
    <p class="calibre_2">can then design the sqrt routine secure in the knowledge its input <span class="italic">will</span> be in range. </p>
    <p class="calibre_2">If your algorithm for calculating the square root fails (or isn't within the specified error </p>
    <p class="calibre_2">tolerance), you get an error message and a stack trace to show you the call chain. </p>
    <p class="calibre_2">If you pass sqrt a negative parameter, the Eiffel runtime prints the error </p>
    <p class="calibre_2">"sqrt_arg_must_be_positive," along with a stack trace. This is better than the alternative in </p>
    <p class="calibre_2">languages such as Java, C, and C++, where passing a negative number to sqrt returns the </p>
    <p class="calibre_2">special value NaN (Not a Number). It may be some time later in the program that you </p>
    <p class="calibre_2">attempt to do some math on NaN, with surprising results. </p>
    <p class="calibre_2">It's much easier to find and diagnose the problem by crashing early, at the site of the </p>
    <p class="calibre_2">problem. </p>
    <p class="calibre_2">
      <span class="bold">Other Uses of Invariants</span>
    </p>
    <p class="calibre_2">So far we have discussed pre- and postconditions that apply to individual methods and </p>
    <p class="calibre_2">invariants that apply to all methods within a class, but there are other useful ways to use </p>
    <p class="calibre_2">invariants. </p>
    <p class="calibre_2">
      <span class="bold">Loop Invariants</span>
    </p>
    <p class="calibre_2">Getting the boundary conditions right on a nontrMal loop can be problematic. Loops are </p>
    <p class="calibre_2">subject to the banana problem (I know how to spell "banana," but I don't know when to </p>
    <p class="calibre_2">stop), fencepost errors (not knowing whether to count the fenceposts or the spaces </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">between them), and the ubiquitous "off by one" error [URL 52]. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">Invariants can help in these situations: a <span class="italic">loop invariant</span> is a statement of the eventual goal </p>
    <p class="calibre_2">of a loop, but is generalized so that it is also valid before the loop executes and on each </p>
    <p class="calibre_2">iteration through the loop. You can think of it as a kind of miniature contract. The classic </p>
    <p class="calibre_2">example is a routine that finds the maximum value in an array. </p>
    <p class="calibre_2"><span class="bold">int</span> m = arr[0]; // <span class="italic">example assumes arr.length &gt; 0</span></p>
    <p class="calibre_2"><span class="bold">int</span> i = 1; </p>
    <p class="calibre_2">// <span class="italic">Loop invariant: m = max(arr[0:i-1])</span></p>
    <p class="calibre_2"><span class="bold">while</span> (i &lt; arr.length) {</p>
    <p class="calibre_2">m = Math.max(m, arr[i]); </p>
    <p class="calibre_2">i = i + 1; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">( <span class="italic">arr[m:n]</span> is a notational convenience meaning a slice of the array from index <span class="italic">m</span> to <span class="italic">n. </span>) The </p>
    <p class="calibre_2">invariant must be true before the loop runs, and the body of the loop must ensure that it </p>
    <p class="calibre_2">remains true as the loop executes. In this way we know that the invariant also holds when </p>
    <p class="calibre_2">the loop terminates, and therefore that our result is valid. Loop invariants can be coded </p>
    <p class="calibre_2">explicitly as assertions, but they are also useful as design and documentation tools. </p>
    <p class="calibre_2">
      <span class="bold">Semantic Invariants</span>
    </p>
    <p class="calibre_2">You can use <span class="italic">semantic invariants</span> to express inviolate requirements, a kind of </p>
    <p class="calibre_2">"philosophical contract." </p>
    <p class="calibre_2">We once wrote a debit card transaction switch. A major requirement was that the user of a </p>
    <p class="calibre_2">debit card should never have the same transaction applied to their account twice. In other </p>
    <p class="calibre_2">words, no matter what sort of failure mode might happen, the error should be on the side of </p>
    <p class="calibre_2"><span class="italic">not</span> processing a transaction rather than processing a duplicate transaction. </p>
    <p class="calibre_2">This simple law, driven directly from the requirements, proved to be very helpful in sorting </p>
    <p class="calibre_2">out complex error recovery scenarios, and guided the detailed design and implementation </p>
    <p class="calibre_2">in many areas. </p>
    <p class="calibre_2">Be sure not to confuse requirements that are fixed, inviolate laws with those that are </p>
    <p class="calibre_2">merely policies that might change with a new management regime. That's why we use the </p>
    <p class="calibre_2">term <span class="italic">semantic</span> invariantsâ€”it must be central to the very <span class="italic">meaning</span> of a thing, and not </p>
    <p class="calibre_2">subject to the whims of policy (which is what more dynamic business rules are for). </p>
    <p class="calibre_2">When you find a requirement that qualifies, make sure it becomes a well-known part of</p>
    <p class="calibre_2">whatever documentation you are producingâ€” whether it is a bulleted list in the</p>
    <p class="calibre_2">requirements document that gets signed in triplicate or just a big note on the common</p>
    <p class="calibre_2">whiteboard that everyone sees. Try to state it clearly and unambiguously. For example, in</p>
    <p class="calibre_2">the debit card example, we might write</p>
    <p class="calibre_2">ERR IN FAVOR OF THE CONSUMER. </p>
    <p class="calibre_2">This is a clear, concise, unambiguous statement that's applicable in many different areas of </p>
    <p class="calibre_2">the system. It is our contract with all users of the system, our guarantee of behavior. </p>
    <p class="calibre_2">
      <span class="bold">Dynamic Contracts and Agents</span>
    </p>
    <p class="calibre_2">Until now, we have talked about contracts as fixed, immutable specifications. But in the </p>
    <p class="calibre_2">landscape of autonomous agents, this doesn't need to be the case. By the definition of </p>
    <p class="calibre_2">"autonomous," agents are free to <span class="italic">reject</span> requests that they do not want to honor. They are</p>
    <p class="calibre_2">free to renegotiate the contractâ€”"I can't provide that, but if you give me this, then I might</p>
    <p class="calibre_2">provide something else." </p>
    <p class="calibre_2">Certainly any system that relies on agent technology has a <span class="italic">critical</span> dependence on</p>
    <p class="calibre_2">contractual arrangementsâ€”even if they are dynamically generated. </p>
    <p class="calibre_2">Imagine: with enough components and agents that can negotiate their own contracts </p>
    <p class="calibre_2">among themselves to achieve a goal, we might just solve the software productivity crisis by </p>
    <p class="calibre_2">letting software solve it for us. </p>
    <p class="calibre_2">But if we can't use contracts by hand, we won't be able to use them automatically. So next </p>
    <p class="calibre_2">time you design a piece of software, design its contract as well. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Orthogonality</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Dead Programs Tell No Lies</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Assertive Programming</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">How to Balance Resources</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Decoupling and the Law of Demeter</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Temporal Coupling</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Programming by Coincidence</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Code That's Easy to Test</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Pragmatic Teams</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Points to ponder: If DBC is so powerful, why isn't it used more widely? Is it hard to </p>
    <p class="calibre_2">come up with the contract? Does it make you think about issues you'd rather ignore </p>
    <p class="calibre_2">for now? Does it force you to THINK!? Clearly, this is a dangerous tool! </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <span class="bold">14. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">What makes a good contract? Anyone can add preconditions and </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">postconditions, but will they do you any good? Worse yet, will they actually do </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">more harm than good? For the example below and for those in Exercises 15 </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">and 16, decide whether the specified contract is good, bad, or ugly, and </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">explain why</span></span></a>. </p>
    <p class="calibre_2">First, let's look at an Eiffel example. Here we have a routine for adding a </p>
    <p class="calibre_2">STRING to a doubly linked, circular list (remember that preconditions are </p>
    <p class="calibre_2">labeled with require, and postconditions with ensure). </p>
    <p class="calibre_2">-- <span class="italic">Add an item to a doubly linked list, </span></p>
    <p class="calibre_2">-- <span class="italic">and return the newly created NODE. </span></p>
    <p class="calibre_2">add_item (item : STRING) : NODE <span class="bold">is</span></p>
    <p class="calibre_2">
      <span class="bold">require</span>
    </p>
    <p class="calibre_2">item /= Void -- <span class="italic">'/=' is 'not equal'. </span></p>
    <p class="calibre_2"><span class="bold">deferred</span> -- <span class="italic">Abstract base class. </span></p>
    <p class="calibre_2">
      <span class="bold">ensure</span>
    </p>
    <p class="calibre_2">result.next.previous = result -- <span class="italic">Check the newly</span></p>
    <p class="calibre_2">result.previous.next = result -- <span class="italic">added node's links. </span></p>
    <p class="calibre_2">find_item(item) = result -- <span class="italic">Should find it. </span></p>
    <p class="calibre_2">
      <span class="bold">end</span>
    </p>
    <p class="calibre_2">
      <span class="bold">15. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Next, let's try an example in Java?somewhat similar to the example in</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Exercise 14. insertNumber inserts an integer into an ordered list. Pre-and </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">postconditions are labeled as in iContract (see [</span>
        </span>
      </a>
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">URL 17]) . </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><span class="bold">private int</span> data[]; </p>
    <p class="calibre_2">/**</p>
    <p class="calibre_2">* <span class="italic">@post data[index-1] &lt; data[index] &amp;&amp; </span></p>
    <p class="calibre_2">* <span class="italic">data[index] == aValue</span></p>
    <p class="calibre_2">*/</p>
    <p class="calibre_2"><span class="bold">public</span> Node insertNumber (<span class="bold">final int</span> aValue)</p>
    <p class="calibre_2">{</p>
    <p class="calibre_2"><span class="bold">int</span> index = findPlaceToInsert(aValue); </p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00322.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00152.jpg"/>
    </p>
    <p class="calibre_2">
      <span class="bold">16. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Here's a fragment from a stack class in Java. Is this a good contract? </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">/**</p>
    <p class="calibre_2">* <span class="italic">@pre anItem != null // Require real data</span></p>
    <p class="calibre_2">* <span class="italic">@post pop() == anItem // Verify that it's</span></p>
    <p class="calibre_2">* <span class="italic">// on the stack</span></p>
    <p class="calibre_2">*/</p>
    <p class="calibre_2"><span class="bold">public void</span> push(<span class="bold">final</span> String anItem)</p>
    <p class="calibre_2">
      <span class="bold">17. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">The classic examples of DBC (as in Exercises 14-16) show an</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">implementation of an ADT (Abstract Data Type)?typically a stack or queue. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">But not many people really write these kinds of low-level classes</span></span></a>. </p>
    <p class="calibre_2">So, for this exercise, design an interface to a kitchen blender. It will eventually </p>
    <p class="calibre_2">be a Web-based, Internet-enabled, CORBA-fied blender, but for now we just </p>
    <p class="calibre_2">need the interface to control it. It has ten speed settings (0 means off). You </p>
    <p class="calibre_2">can't operate it empty, and you can change the speed only one unit at a time </p>
    <p class="calibre_2">(that is, from 0 to 1, and from 1 to 2, not from 0 to 2). </p>
    <p class="calibre_2">Here are the methods. Add appropriate pre- and postconditions and an </p>
    <p class="calibre_2">invariant. </p>
    <p class="calibre_2"><span class="bold">int</span> getSpeed()</p>
    <p class="calibre_2"><span class="bold">void</span> setSpeed(<span class="bold">int</span> x)</p>
    <p class="calibre_2"><span class="bold">boolean</span> isFull()</p>
    <p class="calibre_2"><span class="bold">void</span> fill()</p>
    <p class="calibre_2"><span class="bold">void</span> empty()</p>
    <p class="calibre_2">
      <span class="bold">18. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">How many numbers are in the series 0,5,10,15,?, 100? </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00013.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00236.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Dead Programs Tell No Lies</span>
    </p>
    <p class="calibre_2">Have you noticed that sometimes other people can detect that things aren't well with you </p>
    <p class="calibre_2">before you're aware of the problem yourself? It's the same with other people's code. If </p>
    <p class="calibre_2">something is starting to go awry with one of our programs, sometimes it is a library routine </p>
    <p class="calibre_2">that catches it first. Maybe a stray pointer has caused us to overwrite a file handle with </p>
    <p class="calibre_2">something meaningless. The next call to read will catch it. Perhaps a buffer overrun has </p>
    <p class="calibre_2">trashed a counter we're about to use to determine how much memory to allocate. Maybe </p>
    <p class="calibre_2">we'll get a failure from malloc. A logic error a couple of million instructions ago means that </p>
    <p class="calibre_2">the selector for a case statement is no longer the expected 1, 2, or 3. We'll hit the default</p>
    <p class="calibre_2">case (which is one reason why each and every case/switch statement needs to have a</p>
    <p class="calibre_2">default clauseâ€”we want to know when the "impossible" has happened). </p>
    <p class="calibre_2">It's easy to fall into the "it can't happen" mentality. Most of us have written code that didn't</p>
    <p class="calibre_2">check that a file closed successfully, or that a trace statement got written as we expected. </p>
    <p class="calibre_2">And all things being equal, it's likely that we didn't need toâ€”the code in question wouldn't</p>
    <p class="calibre_2">fail under any normal conditions. But we're coding defensively. We're looking for rogue</p>
    <p class="calibre_2">pointers in other parts of our program trashing the stack. We're checking that the correct</p>
    <p class="calibre_2">versions of shared libraries were actually loaded. </p>
    <p class="calibre_2">All errors give you information. You could convince yourself that the error can't happen, </p>
    <p class="calibre_2">and choose to ignore it. Instead, Pragmatic Programmers tell themselves that if there is an </p>
    <p class="calibre_2">error, something very, very bad has happened. </p>
    <p class="calibre_2">
      <span class="bold">Tip 32</span>
    </p>
    <p class="calibre_2">Crash Early</p>
    <p class="calibre_2">
      <span class="bold">Crash, Don't Trash</span>
    </p>
    <p class="calibre_2">One of the benefits of detecting problems as soon as you can is that you can crash earlier. </p>
    <p class="calibre_2">And many times, crashing your program is the best thing you can do. The alternative may </p>
    <p class="calibre_2">be to continue, writing corrupted data to some vital database or commanding the washing </p>
    <p class="calibre_2">machine into its twentieth consecutive spin cycle. </p>
    <p class="calibre_2">The Java language and libraries have embraced this philosophy. When something </p>
    <p class="calibre_2">unexpected happens within the runtime system, it throws a RuntimeException. If not </p>
    <p class="calibre_2">caught, this will percolate up to the top level of the program and cause it to halt, displaying </p>
    <p class="calibre_2">a stack trace. </p>
    <p class="calibre_2">You can do the same in other languages. If you don't have an exception mechanism, or if </p>
    <p class="calibre_2">your libraries don't throw exceptions, then make sure you handle the errors yourself. In C, </p>
    <p class="calibre_2">macros can be very useful for this:</p>
    <p class="calibre_2"><span class="bold">#define</span> CHECK(LINE, EXPECTED) \</p>
    <p class="calibre_2">{ <span class="bold">int</span> rc = LINE; \</p>
    <p class="calibre_2"><span class="bold">if</span> (rc != EXPECTED) \</p>
    <p class="calibre_2">ut_abort(__FILE__, __LINE__, #LINE, rc, EXPECTED); }</p>
    <p class="calibre_2"><span class="bold">void</span> ut_abort(<span class="bold">char</span> *file, <span class="bold">int</span> ln, <span class="bold">char</span> *line, <span class="bold">int</span> rc, <span class="bold">int</span> exp) {</p>
    <p class="calibre_2">fprintf(stderr, <span class="italic">"%s line %d\n'%s': expected %d, got %d\n", </span></p>
    <p class="calibre_2">file, ln, line, exp, rc); </p>
    <p class="calibre_2">exit(1); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">Then you can wrap calls that should never fail using</p>
    <p class="calibre_2">CHECK(stat("/tmp", &amp;stat_buff), 0); </p>
    <p class="calibre_2">If it should fail, you'd get a message written to stderr:</p>
    <p class="calibre_2">source.c line 19</p>
    <p class="calibre_2">'stat("/tmp", &amp;stat_buff)': expected 0, got -1</p>
    <p class="calibre_2">Clearly it is sometimes inappropriate simply to exit a running program. You may have </p>
    <p class="calibre_2">claimed resources that might not get released, or you may need to write log messages, tidy </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">up open transactions, or interact with other processes. The techniques we discuss in When </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">to Use Exceptions, will help here. However, the basic principle stays the sameâ€”when you</span></span></a>r</p>
    <p class="calibre_2">code discovers that something that was supposed to be impossible just happened, your</p>
    <p class="calibre_2">program is no longer viable. Anything it does from this point forward becomes suspect, so</p>
    <p class="calibre_2">terminate it as soon as possible. A dead program normally does a lot less damage than a</p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00277.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00349.jpg"/>
    </p>
    <p class="calibre_2">crippled one. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Design by Contract</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">When to Use Exceptions</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00243.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00216.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Assertive Programming</span>
    </p>
    <p class="calibre_2">
      <span class="italic">There is a luxury in self-reproach. When we blame ourselves we feel no one else has </span>
    </p>
    <p class="calibre_2">
      <span class="italic">a right to blame us. </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Oscar Wilde, The </span>
      <span class="italic">
        <span class="bold">Picture of Dorian Gray</span>
      </span>
    </p>
    <p class="calibre_2">It seems that there's a mantra that every programmer must memorize early in his or her </p>
    <p class="calibre_2">career. It is a fundamental tenet of computing, a core belief that we learn to apply to </p>
    <p class="calibre_2">requirements, designs, code, comments, just about everything we do. It goes</p>
    <p class="calibre_2">THIS CAN NEVER HAPPENâ€¦</p>
    <p class="calibre_2">"This code won't be used 30 years from now, so two-digit dates are fine." "This application</p>
    <p class="calibre_2">will never be used abroad, so why internationalize it?" "count can't be negative." "This printf</p>
    <p class="calibre_2">can't fail." </p>
    <p class="calibre_2">Let's not practice this kind of self-deception, particularly when coding. </p>
    <p class="calibre_2">
      <span class="bold">Tip 33</span>
    </p>
    <p class="calibre_2">If It Can't Happen, Use Assertions to Ensure That It Won't</p>
    <p class="calibre_2">Whenever you find yourself thinking "but of course that could never happen," add code to </p>
    <p class="calibre_2">check it. The easiest way to do this is with assertions. In most C and C++ implementations, </p>
    <p class="calibre_2">you'll find some form of assert or _assert macro that checks a Boolean condition. These </p>
    <p class="calibre_2">macros can be invaluable. If a pointer passed in to your procedure should never be NULL, </p>
    <p class="calibre_2">then check for it:</p>
    <p class="calibre_2"><span class="bold">void</span> writeString(<span class="bold">char</span> *string) {</p>
    <p class="calibre_2">assert(string != NULL); </p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">Assertions are also useful checks on an algorithm's operation. Maybe you've written a </p>
    <p class="calibre_2">clever sort algorithm. Check that it works:</p>
    <p class="calibre_2"><span class="bold">for</span> (<span class="bold">int</span> i = 0; i &lt; num_entries-1; i++) {</p>
    <p class="calibre_2">assert(sorted[i] &lt;= sorted[i+i]); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">Of course, the condition passed to an assertion should not have a side effect (see the box</p>
    <p class="calibre_2">on page 124). Also remember that assertions may be turned off at compile timeâ€”never put</p>
    <p class="calibre_2">code that <span class="italic">must</span> be executed into an assert. </p>
    <p class="calibre_2">Don't use assertions in place of real error handling. Assertions check for things that should </p>
    <p class="calibre_2">never happen: you don't want to be writing code such as</p>
    <p class="calibre_2">printf(" <span class="italic">Enter 'Y' or 'N':</span> "); </p>
    <p class="calibre_2">ch = getchar(); </p>
    <p class="calibre_2">assert((ch == 'Y') || (ch == 'N')); /* <span class="italic">bad idea! </span> */</p>
    <p class="calibre_2">And just because the supplied assert macros call exit when an assertion fails, there's no </p>
    <p class="calibre_2">reason why versions you write should. If you need to free resources, have an assertion </p>
    <p class="calibre_2">failure generate an exception, longjmp to an exit point, or call an error handler. Just make </p>
    <p class="calibre_2">sure the code you execute in those dying milliseconds doesn't rely on the information that </p>
    <p class="calibre_2">triggered the assertion failure in the first place. </p>
    <p class="calibre_2">
      <span class="bold">Leave Assertions Turned On</span>
    </p>
    <p class="calibre_2">There is a common misunderstanding about assertions, promulgated by the people who </p>
    <p class="calibre_2">write compilers and language environments. It goes something like this:</p>
    <p class="calibre_2">
      <span class="italic">Assertions odd some overhead to code. Because they check for things </span>
    </p>
    <p class="calibre_2">
      <span class="italic">that should never happen, they'll get triggered only by a bug in the </span>
    </p>
    <p class="calibre_2">
      <span class="italic">code. Once the code has been tested and shipped, they are no longer </span>
    </p>
    <p class="calibre_2">
      <span class="italic">needed, and should be turned off to make the code run faster. </span>
    </p>
    <p class="calibre_2">
      <span class="italic">Assertions are a debugging facility. </span>
    </p>
    <p class="calibre_2">There are two patently wrong assumptions here. First, they assume that testing finds all </p>
    <p class="calibre_2">the bugs. In reality, for any complex program you are unlikely to test even a miniscule </p>
    <p class="calibre_2">percentage of the permutations your code will be put through (see <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Ruthless Testing</span></span></a>). </p>
    <p class="calibre_2">Second, the optimists are forgetting that your program runs in a dangerous world. During </p>
    <p class="calibre_2">testing, rats probably won't gnaw through a communications cable, someone playing a </p>
    <p class="calibre_2">game won't exhaust memory, and log files won't fill the hard drive. These things might </p>
    <p class="calibre_2">happen when your program runs in a production environment. Your first line of defense is </p>
    <p class="calibre_2">checking for any possible error, and your second is using assertions to try to detect those </p>
    <p class="calibre_2">you've missed. </p>
    <p class="calibre_2">Turning off assertions when you deliver a program to production is like crossing a high wire </p>
    <p class="calibre_2">without a net because you once made it across in practice. There's dramatic value, but it's </p>
    <p class="calibre_2">hard to get life insurance. </p>
    <p class="calibre_2">Even if you <span class="italic">do</span> have performance issues, turn off only those assertions that really hit you. </p>
    <p class="calibre_2">The sort example above may be a critical part of</p>
    <p class="calibre_2">
      <span class="bold">Assertion and Side Effects</span>
    </p>
    <p class="calibre_2">It is embarrassing when the code we add to detect errors actually ends up </p>
    <p class="calibre_2">creatings new errors. This can happen with assertions if evaluating the condition </p>
    <p class="calibre_2">has side effects. for example, in Java it would be a bad to code something such </p>
    <p class="calibre_2">as</p>
    <p class="calibre_2"><span class="bold">while</span> (iter.hasmoreElements () {</p>
    <p class="calibre_2">Test.ASSERT(iter.nextElements() != <span class="bold">null</span>); </p>
    <p class="calibre_2">object obj = iter.nextElement(); </p>
    <p class="calibre_2">// .... </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">The .nextElement() call in the ASSERT has the side effects of moving the iterator </p>
    <p class="calibre_2">past the element being fetched, and so the loop will process only half the </p>
    <p class="calibre_2">elements in the collection. It would be better to write</p>
    <p class="calibre_2"><span class="bold">while</span> (iter.hasmoreElements()) {</p>
    <p class="calibre_2">object obj = iter.nextElement(); </p>
    <p class="calibre_2">Test.ASSERT(obj != <span class="bold">null</span>); </p>
    <p class="calibre_2">//.... </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">This problem is a kind of "Heisenbug"â€”debugging that changes the behavior of</p>
    <p class="calibre_2">the system system being debugged (see <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[URL 52]). </span></span></a></p>
    <p class="calibre_2">your application, and may need to be fast. Adding the check means another pass through </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">the data, which might be unacceptable. Make that particular check optional,[2] but leave th</span></span></a>e</p>
    <p class="calibre_2">rest in. </p>
    <p class="calibre_2">[2] In C-based languages, you can either use the preprocessor or use if statements to make assertions </p>
    <p class="calibre_2">optional. Many implementations turn off code generation for the assert macro if a compile-time flag is set </p>
    <p class="calibre_2">(or not set). Otherwise, you can place the code within an if statement with a constant condition, which </p>
    <p class="calibre_2">many compilers (including most common Java systems) will optimize away. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Debugging</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Design by Contract</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">How to Balance Resources</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Programming by Coincidence</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <span class="bold">19. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">A quick reality check. Which of these "impossible" things can happen? </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">1. A month with fewer than 28 days</p>
    <p class="calibre_2">2. stat("." ,&amp;sb) == -1 (that is, can't access the current directory)</p>
    <p class="calibre_2">3. In C++: a = 2; b = 3; <span class="bold">if</span> (a + b != 5) exit(1); </p>
    <p class="calibre_2">4. A triangle with an interior angle sum \u8800 180Â°</p>
    <p class="calibre_2">5. A minute that doesn't have 60 seconds</p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00336.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00132.jpg"/>
    </p>
    <p class="calibre_2">6. In Java: a + 1) &lt;= a</p>
    <p class="calibre_2">
      <span class="bold">20. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Develop a simple assertion checking class for Java. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00310.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00002.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">When to Use Exceptions</span>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">In Dead Programs Tell No Lies</span></span></a>, we suggested that it is good practice to check for every</p>
    <p class="calibre_2">possible errorâ€”particularly the unexpected ones. However, in practice this can lead to</p>
    <p class="calibre_2">some pretty ugly code; the normal logic of your program can end up being totally obscured</p>
    <p class="calibre_2">by error handling, particularly if you subscribe to the "a routine must have a single return</p>
    <p class="calibre_2">statement" school of programming (we don't). We've seen code that looks something like</p>
    <p class="calibre_2">the following:</p>
    <p class="calibre_2">retcode = OK; </p>
    <p class="calibre_2"><span class="bold">if</span> (socket.read(name) != OK) {</p>
    <p class="calibre_2">retcode = BAD_READ; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">else</span> {</p>
    <p class="calibre_2">processName(name); </p>
    <p class="calibre_2"><span class="bold">if</span> (socket.read(address) != OK) {</p>
    <p class="calibre_2">retcode = BAD_READ; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">else</span> {</p>
    <p class="calibre_2">processAddress(address); </p>
    <p class="calibre_2"><span class="bold">if</span> (socket.read(telNo) != OK) {</p>
    <p class="calibre_2">retcode = BAD_READ; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">else</span> {</p>
    <p class="calibre_2">// <span class="italic">etc, etc... </span></p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">return</span> retcode; </p>
    <p class="calibre_2">Fortunately, if the programming language supports exceptions, you can rewrite this code in </p>
    <p class="calibre_2">a far neater way:</p>
    <p class="calibre_2">retcode = OK; </p>
    <p class="calibre_2"><span class="bold">try</span> {</p>
    <p class="calibre_2">socket.read(name); </p>
    <p class="calibre_2">process(name); </p>
    <p class="calibre_2">socket.read(address); </p>
    <p class="calibre_2">processAddress(address); </p>
    <p class="calibre_2">socket.read(telNo); </p>
    <p class="calibre_2">// <span class="italic">etc, etc... </span></p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">catch</span> (IOException e) {</p>
    <p class="calibre_2">retcode = BAD_READ; </p>
    <p class="calibre_2">Logger.log( <span class="italic">"Error reading individual: " </span> + e.getMessage()); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">return</span> retcode; </p>
    <p class="calibre_2">The normal flow of control is now clear, with all the error handling moved off to a single </p>
    <p class="calibre_2">place. </p>
    <p class="calibre_2">
      <span class="bold">What Is Exceptional? </span>
    </p>
    <p class="calibre_2">One of the problems with exceptions is knowing when to use them. We believe that </p>
    <p class="calibre_2">exceptions should rarely be used as part of a program's normal flow; exceptions should be </p>
    <p class="calibre_2">reserved for unexpected events. Assume that an uncaught exception will terminate your </p>
    <p class="calibre_2">program and ask yourself, "Will this code still run if I remove all the exception handlers?" If </p>
    <p class="calibre_2">the answer is "no," then maybe exceptions are being used in nonexceptional </p>
    <p class="calibre_2">circumstances. </p>
    <p class="calibre_2">For example, if your code tries to open a file for reading and that file does not exist, should </p>
    <p class="calibre_2">an exception be raised? </p>
    <p class="calibre_2">Our answer is, "It depends." If the file <span class="italic">should</span> have been there, then an exception is</p>
    <p class="calibre_2">warranted. Something unexpected happenedâ€”a file you were expecting to exist seems to</p>
    <p class="calibre_2">have disappeared. On the other hand, if you have no idea whether the file should exist or</p>
    <p class="calibre_2">not, then it doesn't seem exceptional if you can't find it, and an error return is appropriate. </p>
    <p class="calibre_2">Let's look at an example of the first case. The following code opens the file /etc/passwd, </p>
    <p class="calibre_2">which should exist on all Unix systems. If it fails, it passes on the FileNotFoundException to </p>
    <p class="calibre_2">its caller. </p>
    <p class="calibre_2"><span class="bold">public void</span> open_passwd() <span class="bold">throws</span> FileNotFoundException {</p>
    <p class="calibre_2">// <span class="italic">This may throw FileNotFoundException... </span></p>
    <p class="calibre_2">ipstream = <span class="bold">new</span> FileInputStream(" <span class="italic">/etc/passwd</span>"); </p>
    <p class="calibre_2">// ... </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">However, the second case may involve opening a file specified by the user on the </p>
    <p class="calibre_2">command line. Here an exception isn't warranted, and the code looks different:</p>
    <p class="calibre_2"><span class="bold">public boolean</span> open_user_file(String name)</p>
    <p class="calibre_2"><span class="bold">throws</span> FileNotFoundException {</p>
    <p class="calibre_2">File f = <span class="bold">new</span> File(name); </p>
    <p class="calibre_2"><span class="bold">if</span> (!f.exists()) {</p>
    <p class="calibre_2">
      <span class="bold">return false; </span>
    </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">ipstream = <span class="bold">new</span> FileInputStream(f); </p>
    <p class="calibre_2">
      <span class="bold">return true; </span>
    </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">Note that the FileInputStream call can still generate an exception, which the routine passes </p>
    <p class="calibre_2">on. However, the exception will be generated under only truly exceptional circumstances; </p>
    <p class="calibre_2">simply trying to open a file that does not exist will generate a conventional error return. </p>
    <p class="calibre_2">
      <span class="bold">Tip 34</span>
    </p>
    <p class="calibre_2">Use Exceptions for Exceptional Problems</p>
    <p class="calibre_2">Why do we suggest this approach to exceptions? Well, an exception represents an</p>
    <p class="calibre_2">immediate, nonlocal transfer of controlâ€”it's a kind of cascading goto. Programs that use </p>
    <p class="calibre_2">exceptions as part of their normal processing suffer from all the readability and </p>
    <p class="calibre_2">maintainability problems of classic spaghetti code. These programs break encapsulation: </p>
    <p class="calibre_2">routines and their callers are more tightly coupled via exception handling. </p>
    <p class="calibre_2">
      <span class="bold">Error Handlers Are an Alternative</span>
    </p>
    <p class="calibre_2">An error handler is a routine that is called when an error is detected. You can register a </p>
    <p class="calibre_2">routine to handle a specific category of errors. When one of these errors occurs, the </p>
    <p class="calibre_2">handler will be called. </p>
    <p class="calibre_2">There are times when you may want to use error handlers, either instead of or alongside </p>
    <p class="calibre_2">exceptions. Clearly, if you are using a language such as C, which does not support </p>
    <p class="calibre_2">exceptions, this is one of your few other options (see the challenge on the next page). </p>
    <p class="calibre_2">However, sometimes error handlers can be used even in languages (such as Java) that </p>
    <p class="calibre_2">have a good exception handling scheme built in. </p>
    <p class="calibre_2">Consider the implementation of a client-server application, using Java's Remote Method </p>
    <p class="calibre_2">Invocation (RMI) facility. Because of the way RMI is implemented, every call to a remote </p>
    <p class="calibre_2">routine must be prepared to handle a RemoteException. Adding code to handle these </p>
    <p class="calibre_2">exceptions can become tedious, and means that it is difficult to write code that works with </p>
    <p class="calibre_2">both local and remote routines. A possible work-around is to wrap your remote objects in a </p>
    <p class="calibre_2">class that is not remote. This class then implements an error handler interface, allowing the </p>
    <p class="calibre_2">client code to register a routine to be called when a remote exception is detected. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Dead Programs Tell No Lies</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Languages that do not support exceptions often have some other nonlocal transfer </p>
    <p class="calibre_2">of control mechanism (C has longjmp/setjmp, for example). Consider how you </p>
    <p class="calibre_2">could implement some kind of ersatz exception mechanism using these facilities. </p>
    <p class="calibre_2">What are the benefits and dangers? What special steps do you need to take to </p>
    <p class="calibre_2">ensure that resources are not orphaned? Does it make sense to use this kind of </p>
    <p class="calibre_2">solution whenever you code in C? </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00025.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00103.jpg"/>
    </p>
    <p class="calibre_2">
      <span class="bold">21. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">While designing a new container class, you identify the following possible </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">error conditions</span></span></a>:</p>
    <p class="calibre_2">1. No memory available for a new element in the add routine</p>
    <p class="calibre_2">2. Requested entry not found in the fetch routine</p>
    <p class="calibre_2">3. null pointer passed to the add routine</p>
    <p class="calibre_2">How should each be handled? Should an error be generated, should an </p>
    <p class="calibre_2">exception be raised, or should the condition be ignored? </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00146.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00219.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">How to Balance Resources</span>
    </p>
    <p class="calibre_2">
      <span class="italic">"I brought you into this world, " my father would say," and I can take you out. It don't </span>
    </p>
    <p class="calibre_2">
      <span class="italic">make no difference to me. I'll just make another one like you." </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Bill Cosby, </span>
      <span class="italic">
        <span class="bold">Fatherhood</span>
      </span>
    </p>
    <p class="calibre_2">We all manage resources whenever we code: memory, transactions, threads, flies, </p>
    <p class="calibre_2">timersâ€”all kinds of things with limited availability. Most of the time, resource usage follows</p>
    <p class="calibre_2">a predictable pattern: you allocate the resource, use it, and then deallocate it. </p>
    <p class="calibre_2">However, many developers have no consistent plan for dealing with resource allocation </p>
    <p class="calibre_2">and deallocation. So let us suggest a simple tip:</p>
    <p class="calibre_2">
      <span class="bold">Tip 35</span>
    </p>
    <p class="calibre_2">Finish What You Start</p>
    <p class="calibre_2">This tip is easy to apply in most circumstances. It simply means that the routine or object</p>
    <p class="calibre_2">that allocates a resource should be responsible for deallocating it. Let's see how it applies</p>
    <p class="calibre_2">by looking at an example of some bad codeâ€”an application that opens a file, reads</p>
    <p class="calibre_2">customer information from it, updates a field, and writes the result back. We've eliminated</p>
    <p class="calibre_2">error handling to make the example clearer. </p>
    <p class="calibre_2"><span class="bold">void</span> readCustomer(<span class="bold">const char</span> *fName, Customer *cRec) {</p>
    <p class="calibre_2">cFile = fopen(fName, " <span class="italic">r+</span>"); </p>
    <p class="calibre_2">fread(cRec, <span class="bold">sizeof</span>(*cRec), 1, cFile); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">void</span> writeCustomer(Customer *cRec) {</p>
    <p class="calibre_2">rewind(cFile); </p>
    <p class="calibre_2">fwrite (cRec, <span class="bold">sizeof</span>(*cRec), 1, cFile); </p>
    <p class="calibre_2">fclose(cFile); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">void</span> updateCustomer(<span class="bold">const char</span> *fName, <span class="bold">double</span> newBalance) {</p>
    <p class="calibre_2">Customer cRec; </p>
    <p class="calibre_2">readCustomer(fName, &amp;cRec); </p>
    <p class="calibre_2">cRec.balance = newBalance; </p>
    <p class="calibre_2">writeCustomer(&amp;cRec); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">At first sight, the routine updateCustomer looks pretty good. It seems to implement the</p>
    <p class="calibre_2">logic we requireâ€”reading a record, updating the balance, and writing the record back out. </p>
    <p class="calibre_2">However, this tidiness hides a major problem. The routines readCustomer and </p>
    <p class="calibre_2">writeCustomer<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline"> are tightly coupled[3]</span></span></a> â€”they share the global variable cFile.readCustomer</p>
    <p class="calibre_2">opens the file and stores the file pointer in cFile, and writeCustomer uses that stored </p>
    <p class="calibre_2">pointer to close the file when it finishes. This global variable doesn't even appear in the </p>
    <p class="calibre_2">updateCustomer routine. </p>
    <p class="calibre_2">[3] For a discussion of the dangers of coupled code, see<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline"> Decoupling and the Law of Demeter. </span></span></a></p>
    <p class="calibre_2">Why is this bad? Let's consider the unfortunate maintenance programmer who is told that</p>
    <p class="calibre_2">the specification has changedâ€”the balance should be updated only if the new value is not</p>
    <p class="calibre_2">negative. She goes into the source and changes updateCustomer:</p>
    <p class="calibre_2"><span class="bold">void</span> updateCustomer(<span class="bold">const char</span> *fName, <span class="bold">double</span> newBalance) {</p>
    <p class="calibre_2">Customer cRec; </p>
    <p class="calibre_2">readCustomer(fName, &amp;cRec); </p>
    <p class="calibre_2"><span class="bold">if</span> (newBalance &gt;= 0.0) {</p>
    <p class="calibre_2">cRec.balance = newBalance; </p>
    <p class="calibre_2">writeCustomer(&amp;cRec); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">All seems fine during testing. However, when the code goes into production, it collapses </p>
    <p class="calibre_2">after several hours, complaining of <span class="italic">too many open files. </span> Because writeBalance is not </p>
    <p class="calibre_2">getting called in some circumstances, the file is not getting closed. </p>
    <p class="calibre_2">A very bad solution to this problem would be to deal with the special case in </p>
    <p class="calibre_2">updateCustomer:</p>
    <p class="calibre_2"><span class="bold">void</span> updateCustomer(<span class="bold">const char</span> *fName, <span class="bold">double</span> newBalance) {</p>
    <p class="calibre_2">Customer cRec; </p>
    <p class="calibre_2">readCustomer(fName, &amp;cRec); </p>
    <p class="calibre_2"><span class="bold">if</span> (newBalance &gt;= 0.0) {</p>
    <p class="calibre_2">cRec.balance = newBalance; </p>
    <p class="calibre_2">writeCustomer(&amp;cRec); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">
      <span class="bold">else</span>
    </p>
    <p class="calibre_2">fclose(cFile); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">This will fix the problemâ€”the file will now get closed regardless of the new balanceâ€”but</p>
    <p class="calibre_2">the fix now means that <span class="italic">three</span> routines are coupled through the global cFile. We're falling </p>
    <p class="calibre_2">into a trap, and things are going to start going downhill rapidly if we continue on this </p>
    <p class="calibre_2">course. </p>
    <p class="calibre_2">The <span class="italic">finish what you start</span> tip tells us that, ideally, the routine that allocates a resource </p>
    <p class="calibre_2">should also free it. We can apply it here by refactoring the code slightly:</p>
    <p class="calibre_2"><span class="bold">void</span> readCustomer(FILE *cFile, Customer *cRec) {</p>
    <p class="calibre_2">fread(cRec, <span class="bold">sizeof</span>(*cRec), 1, cFile); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">void</span> writeCustomer(FILE *cFile, Customer *cRec) {</p>
    <p class="calibre_2">rewind(cFile); </p>
    <p class="calibre_2">fwrite(cRec, <span class="bold">sizeof</span>(*cRec), 1, cFile); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">void</span> updateCustomer(<span class="bold">const char</span> *fName, <span class="bold">double</span> newBalance) {</p>
    <p class="calibre_2">FILE *cFile; </p>
    <p class="calibre_2">Customer cRec; </p>
    <p class="calibre_2">cFile = fopen(fName, <span class="italic">"r+"); </span> // &gt;---</p>
    <p class="calibre_2">readCustomer(cFile, &amp;cRec); // /</p>
    <p class="calibre_2"><span class="bold">if</span> (newBalance &gt;= 0.0) { // /</p>
    <p class="calibre_2">cRec.balance = newBalance; // /</p>
    <p class="calibre_2">writeCustomer(cFile, &amp;cRec); // /</p>
    <p class="calibre_2">} // /</p>
    <p class="calibre_2">fclose(cFile); // &lt;---</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">Now all the responsibility for the file is in the updateCustomer routine. It opens the file and </p>
    <p class="calibre_2">(finishing what it starts) closes it before exiting. The routine balances the use of the file: the </p>
    <p class="calibre_2">open and close are in the same place, and it is apparent that for every open there will be a </p>
    <p class="calibre_2">corresponding close. The refactoring also removes an ugly global variable. </p>
    <p class="calibre_2">
      <span class="bold">Nest Allocations</span>
    </p>
    <p class="calibre_2">The basic pattern for resource allocation can be extended for routines that need more than </p>
    <p class="calibre_2">one resource at a time. There are just two more suggestions:</p>
    <p class="calibre_2">1. Deallocate resources in the opposite order to that in which you allocate them. That </p>
    <p class="calibre_2">way you won't orphan resources if one resource contains references to another. </p>
    <p class="calibre_2">2. When allocating the same set of resources in different places in your code, always </p>
    <p class="calibre_2">allocate them in the same order. This will reduce the possibility of deadlock. (If </p>
    <p class="calibre_2">process A claims resource1 and is about to claim resource2, while process B has </p>
    <p class="calibre_2">claimed resource2 and is trying to get resource1, the two processes will wait </p>
    <p class="calibre_2">forever.)</p>
    <p class="calibre_2">It doesn't matter what kind of resources we're usingâ€”transactions, memory, files, threads, </p>
    <p class="calibre_2">windowsâ€”the basic pattern applies: whoever allocates a resource should be responsible</p>
    <p class="calibre_2">for deallocating it. However, in some languages we can develop the concept further. </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00100.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00093.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00062.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00055.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00224.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00213.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Objects and Exceptions</span>
    </p>
    <p class="calibre_2">The equilibrium between allocations and deallocations is reminiscent of a class's </p>
    <p class="calibre_2">constructor and destructor. The class represents a resource, the constructor gives you a </p>
    <p class="calibre_2">particular object of that resource type, and the destructor removes it from your scope. </p>
    <p class="calibre_2">If you are programming in an object-oriented language, you may find it useful to </p>
    <p class="calibre_2">encapsulate resources in classes. Each time you need a particular resource type, you </p>
    <p class="calibre_2">instantiate an object of that class. When the object goes out of scope, or is reclaimed by </p>
    <p class="calibre_2">the garbage collector, the object's destructor then deallocates the wrapped resource. </p>
    <p class="calibre_2">This approach has particular benefits when you're working with languages such as C++, </p>
    <p class="calibre_2">where exceptions can interfere with resource deallocation. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00071.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00206.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Balancing and Exceptions</span>
    </p>
    <p class="calibre_2">Languages that support exceptions can make resource deallocation tricky. If an exception </p>
    <p class="calibre_2">is thrown, how do you guarantee that everything allocated prior to the exception is tidied </p>
    <p class="calibre_2">up? The answer depends to some extent on the language. </p>
    <p class="calibre_2">
      <span class="bold">Balancing Resources with C++ Exceptions</span>
    </p>
    <p class="calibre_2">C++ supports a tryâ€¦catch exception mechanism. Unfortunately, this means that there are </p>
    <p class="calibre_2">always at least two possible paths when exiting a routine that catches and then rethrows </p>
    <p class="calibre_2">an exception:</p>
    <p class="calibre_2"><span class="bold">void</span> doSomething(<span class="bold">void</span>) {</p>
    <p class="calibre_2">Node *n = <span class="bold">new</span> Node; </p>
    <p class="calibre_2">try {</p>
    <p class="calibre_2">// <span class="italic">do something</span></p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">catch (...) {</p>
    <p class="calibre_2"><span class="bold">delete</span> n; </p>
    <p class="calibre_2">throw; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">delete</span> n; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">Notice that the node we create is freed in two placesâ€”once in the routine's normal exit</p>
    <p class="calibre_2">path, and once in the exception handler. This is an obvious violation of the <span class="italic">DRY</span> principle </p>
    <p class="calibre_2">and a maintenance problem waiting to happen. </p>
    <p class="calibre_2">However, we can use the semantics of C++ to our advantage. Local objects are </p>
    <p class="calibre_2">automatically destroyed on exiting from their enclosing block. This gives us a couple of </p>
    <p class="calibre_2">options. If the circumstances permit, we can change "n" from a pointer to an actual Node </p>
    <p class="calibre_2">object on the stack:</p>
    <p class="calibre_2"><span class="bold">void</span> doSomething1(<span class="bold">void</span>) {</p>
    <p class="calibre_2">Node n; </p>
    <p class="calibre_2">try {</p>
    <p class="calibre_2">// <span class="italic">do something</span></p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">catch (...) {</p>
    <p class="calibre_2">throw; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">Here we rely on C++ to handle the destruction of the Node object automatically, whether </p>
    <p class="calibre_2">an exception is thrown or not. </p>
    <p class="calibre_2">If the switch from a pointer is not possible, the same effect can be achieved by wrapping </p>
    <p class="calibre_2">the resource (in this case, a Node pointer) within another class. </p>
    <p class="calibre_2">// <span class="italic">Wrapper class for Node resources</span></p>
    <p class="calibre_2"><span class="bold">class</span> NodeResource {</p>
    <p class="calibre_2">Node *n; </p>
    <p class="calibre_2">
      <span class="bold">public:</span>
    </p>
    <p class="calibre_2">NodeResource() { n = <span class="bold">new</span> Node; }</p>
    <p class="calibre_2">~NodeResource() { <span class="bold">delete</span> n; }</p>
    <p class="calibre_2">Node *<span class="bold">operator</span>-&gt;() { <span class="bold">return</span> n; }</p>
    <p class="calibre_2">}; </p>
    <p class="calibre_2"><span class="bold">void</span> doSomething2(<span class="bold">void</span>) {</p>
    <p class="calibre_2">NodeResource n; </p>
    <p class="calibre_2">try {</p>
    <p class="calibre_2">// <span class="italic">do something</span></p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">catch (...) {</p>
    <p class="calibre_2">throw; </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">Now the wrapper class, NodeResource, ensures that when its objects are destroyed the </p>
    <p class="calibre_2">corresponding nodes are also destroyed. For convenience, the wrapper provides a </p>
    <p class="calibre_2">dereferencing operator -&gt;, so that its users can access the fields in the contained Node </p>
    <p class="calibre_2">object directly. </p>
    <p class="calibre_2">Because this technique is so useful, the standard C++ library provides the template class </p>
    <p class="calibre_2">auto_ptr, which gives you automatic wrappers for dynamically allocated objects. </p>
    <p class="calibre_2"><span class="bold">void</span> doSomething3(<span class="bold">void</span>) {</p>
    <p class="calibre_2">auto_ptr&lt;Node&gt; p <span class="bold">(new</span> Node); </p>
    <p class="calibre_2">// <span class="italic">Access the Node as p-&gt;... </span></p>
    <p class="calibre_2">// <span class="italic">Node automatically deleted</span> at <span class="italic">end</span></p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">
      <span class="bold">Balancing Resources in Java</span>
    </p>
    <p class="calibre_2">Unlike C++, Java implements a lazy form of automatic object destruction. Unreferenced </p>
    <p class="calibre_2">objects are considered to be candidates for garbage collection, and their finalize method </p>
    <p class="calibre_2">will get called should garbage collection ever claim them. While a convenience for </p>
    <p class="calibre_2">developers, who no longer get the blame for most memory leaks, it makes it difficult to </p>
    <p class="calibre_2">implement resource clean-up using the C++ scheme. Fortunately, the designers of the </p>
    <p class="calibre_2">Java language thoughtfully added a language feature to compensate, the finally clause. </p>
    <p class="calibre_2">When a try block contains a finally clause, code in that clause is guaranteed to be </p>
    <p class="calibre_2">executed if any statement in the try block is executed. It doesn't matter whether an </p>
    <p class="calibre_2">exception is thrown (or even if the code in the try block executes a return)â€”the code in the</p>
    <p class="calibre_2">finally clause will get run. This means we can balance our resource usage with code such </p>
    <p class="calibre_2">as</p>
    <p class="calibre_2"><span class="bold">public void</span> doSomething() <span class="bold">throws</span> IOException {</p>
    <p class="calibre_2">File tmpFile = <span class="bold">new</span> File(tmpFileName); </p>
    <p class="calibre_2">FileWriter tmp = <span class="bold">new</span> FileWriter(tmpFile); </p>
    <p class="calibre_2"><span class="bold">try</span> {</p>
    <p class="calibre_2">// <span class="italic">do some work</span></p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">finally</span> {</p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00269.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00296.jpg"/>
    </p>
    <p class="calibre_2">tmpFile.delete(); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">The routine uses a temporary file, which we want to delete, regardless of how the routine </p>
    <p class="calibre_2">exits. The finally block allows us to express this concisely. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00121.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00351.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00313.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00223.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">When You Can't Balance Resources</span>
    </p>
    <p class="calibre_2">There are times when the basic resource allocation pattern just isn't appropriate. </p>
    <p class="calibre_2">Commonly this is found in programs that use dynamic data structures. One routine will </p>
    <p class="calibre_2">allocate an area of memory and link it into some larger structure, where it may stay for </p>
    <p class="calibre_2">some time. </p>
    <p class="calibre_2">The trick here is to establish a semantic invariant for memory allocation. You need to </p>
    <p class="calibre_2">decide who is responsible for data in an aggregate data structure. What happens when you </p>
    <p class="calibre_2">deallocate the top-level structure? You have three main options:</p>
    <p class="calibre_2">1. The top-level structure is also responsible for freeing any substructures that it </p>
    <p class="calibre_2">contains. These structures then recursively delete data they contain, and so on. </p>
    <p class="calibre_2">2. The top-level structure is simply deallocated. Any structures that it pointed to (that </p>
    <p class="calibre_2">are not referenced elsewhere) are orphaned. </p>
    <p class="calibre_2">3. The top-level structure refuses to deallocate itself if it contains any substructures. </p>
    <p class="calibre_2">The choice here depends on the circumstances of each individual data structure. However, </p>
    <p class="calibre_2">you need to make it explicit for each, and implement your decision consistently. </p>
    <p class="calibre_2">Implementing any of these options in a procedural language such as C can be a problem: </p>
    <p class="calibre_2">data structures themselves are not active. Our preference in these circumstances is to </p>
    <p class="calibre_2">write a module for each major structure that provides standard allocation and deallocation </p>
    <p class="calibre_2">facilities for that structure. (This module can also provide facilities such as debug printing, </p>
    <p class="calibre_2">serialization, deserialization, and traversal hooks.)</p>
    <p class="calibre_2">Finally, if keeping track of resources gets tricky, you can write your own form of limited </p>
    <p class="calibre_2">automatic garbage collection by implementing a reference counting scheme on your </p>
    <p class="calibre_2">dynamically allocated objects. The book <span class="italic">More Effective C++</span><span class="calibre_5"><span class="underline"> [Mey96] dedicates a section </span></span></p>
    <p class="calibre_2">to this topic. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00303.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00244.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00104.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00014.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Checking the Balance</span>
    </p>
    <p class="calibre_2">Because Pragmatic Programmers trust no one, including ourselves, we feel that it is </p>
    <p class="calibre_2">always a good idea to build code that actually checks that resources are indeed freed </p>
    <p class="calibre_2">appropriately. For most applications, this normally means producing wrappers for each </p>
    <p class="calibre_2">type of resource, and using these wrappers to keep track of all allocations and </p>
    <p class="calibre_2">deallocations. At certain points in your code, the program logic will dictate that the </p>
    <p class="calibre_2">resources will be in a certain state: use the wrappers to check this. </p>
    <p class="calibre_2">For example, a long-running program that services requests will probably have a single </p>
    <p class="calibre_2">point at the top of its main processing loop where it waits for the next request to arrive. This </p>
    <p class="calibre_2">is a good place to ensure that resource usage has not increased since the last execution of </p>
    <p class="calibre_2">the loop. </p>
    <p class="calibre_2">At a lower, but no less useful level, you can invest in tools that (among other things) check </p>
    <p class="calibre_2">your running programs for memory leaks. Purify (<a href="http://www.rational.com/default.htm"><span class="calibre_5"><span class="underline">http://www.rational.com</span></span></a>) and Insure++ </p>
    <p class="calibre_2">(<a href="http://www.parasoft.com/default.htm"><span class="calibre_5"><span class="underline">http://www.parasoft.com) are popular choices. </span></span></a></p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Design by Contract</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Assertive Programming</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Decoupling and the Law of Demeter</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">Although there are no guaranteed ways of ensuring that you always free resources, </p>
    <p class="calibre_2">certain design techniques, when applied consistently, will help. In the text we </p>
    <p class="calibre_2">discussed how establishing a semantic invariant for major data structures could </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">direct memory deallocation decisions. Consider how Design by Contract</span></span></a>, could </p>
    <p class="calibre_2">help refine this idea. </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00343.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00147.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00143.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00227.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <span class="bold">22. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Some C and C++ developers make a point of setting a pointer to NULL after </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">they deallocate the memory it references. Why is this a good idea? </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">23. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Some Java developers make a point of setting an object variable to NULL</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">after they have finished using the object. Why is this a good idea? </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00173.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00156.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00027.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00220.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Chapter 5. Bend or Break</span>
    </p>
    <p class="calibre_2">Life doesn't stand still. </p>
    <p class="calibre_2">Neither can the code that we write. In order to keep up with today's near-frantic pace of</p>
    <p class="calibre_2">change, we need to make every effort to write code that's as looseâ€”as flexibleâ€”as</p>
    <p class="calibre_2">possible. Otherwise we may find our code quickly becoming outdated, or too brittle to fix, </p>
    <p class="calibre_2">and may ultimately be left behind in the mad dash toward the future. </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">In Reversibility</span></span></a>, we talked about the perils of irreversible decisions. In this chapter, we'll tell </p>
    <p class="calibre_2">you how to make <span class="italic">reversible</span> decisions, so your code can stay flexible and adaptable in the </p>
    <p class="calibre_2">face of an uncertain world. </p>
    <p class="calibre_2">First we need to look at <span class="italic">couplingâ€”</span> the dependencies among modules of code. In </p>
    <p class="calibre_2"><span class="italic">Decoupling and the Law of Demeter</span> we'll show how to keep separate concepts separate, </p>
    <p class="calibre_2">and decrease coupling. </p>
    <p class="calibre_2">A good way to stay flexible is to write <span class="italic">less</span> code. Changing code leaves you open to the </p>
    <p class="calibre_2">possibility of introducing new bugs. <span class="italic">Metaprogramming</span> will explain how to move details out </p>
    <p class="calibre_2">of the code completely, where they can be changed more safely and easily. </p>
    <p class="calibre_2">In <span class="italic">Temporal Coupling, </span> we'll look at two aspects of time as they relate to coupling. Do you </p>
    <p class="calibre_2">depend on the "tick" coming before the "tock"? Not if you want to stay flexible. </p>
    <p class="calibre_2">A key concept in creating flexible code is the separation of a data <span class="italic">model</span> from a <span class="italic">view, </span> or </p>
    <p class="calibre_2">presentation, of that model. We'll decouple models from views in <span class="italic">It's Just a View. </span></p>
    <p class="calibre_2">Finally, there's a technique for decoupling modules even further by providing a meeting </p>
    <p class="calibre_2">place where modules can exchange data anonymously and asynchronously. This is the </p>
    <p class="calibre_2">topic of <span class="italic">Blackboards. </span></p>
    <p class="calibre_2">Armed with these techniques, you can write code that will "roll with the punches." </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00290.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00126.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Decoupling and the Law of Demeter</span>
    </p>
    <p class="calibre_2">
      <span class="italic">Good fences make good neighbors. </span>
    </p>
    <p class="calibre_2">
      <span class="bold">Robert Frost, "Mending Wall" </span>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">In Orthogonality</span></span></a><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">, and Design by Contract</span></span></a>, we suggested that writing "shy" code is </p>
    <p class="calibre_2">beneficial. But "shy" works two ways: don't reveal yourself to others, and don't interact with </p>
    <p class="calibre_2">too many people. </p>
    <p class="calibre_2">Spies, dissidents, revolutionaries, and such are often organized into small groups of people </p>
    <p class="calibre_2">called <span class="italic">cells. </span> Although individuals in each cell may know each other, they have no </p>
    <p class="calibre_2">knowledge of those in other cells. If one cell is discovered, no amount of truth serum will </p>
    <p class="calibre_2">reveal the names of others outside the cell. Eliminating interactions between cells protects </p>
    <p class="calibre_2">everyone. </p>
    <p class="calibre_2">We feel that this is a good principle to apply to coding as well. Organize your code into </p>
    <p class="calibre_2">cells (modules) and limit the interaction between them. If one module then gets </p>
    <p class="calibre_2">compromised and has to be replaced, the other modules should be able to carry on. </p>
    <p class="calibre_2">
      <span class="bold">Minimize Coupling</span>
    </p>
    <p class="calibre_2">What's wrong with having modules that know about each other? Nothing in principleâ€”we</p>
    <p class="calibre_2">don't need to be as paranoid as spies or dissidents. However, you do need to be careful</p>
    <p class="calibre_2">about <span class="italic">how many</span> other modules you interact with and, more importantly, <span class="italic">how</span> you came to </p>
    <p class="calibre_2">interact with them. </p>
    <p class="calibre_2">Suppose you are remodeling your house, or building a house from scratch. A typical</p>
    <p class="calibre_2">arrangement involves a "general contractor." You hire the contractor to get the work done, </p>
    <p class="calibre_2">but the contractor may or may not do the construction personally; the work may be offered</p>
    <p class="calibre_2">to various subcontractors. But as the client, you are not involved in dealing with the</p>
    <p class="calibre_2">subcontractors directlyâ€”the general contractor assumes that set of headaches on your</p>
    <p class="calibre_2">behalf. </p>
    <p class="calibre_2">We'd like to follow this same model in software. When we ask an object for a particular </p>
    <p class="calibre_2">service, we'd like the service to be performed on our behalf. We <span class="italic">do not</span> want the object to </p>
    <p class="calibre_2">give us a third-party object that we have to deal with to get the required service. </p>
    <p class="calibre_2">For example, suppose you are writing a class that generates a graph of scientific recorder </p>
    <p class="calibre_2">data. You have data recorders spread around the world; each recorder object contains a </p>
    <p class="calibre_2">location object giving its position and time zone. You want to let your users select a </p>
    <p class="calibre_2">recorder and plot its data, labeled with the correct time zone. You might write</p>
    <p class="calibre_2"><span class="bold">public void</span> plotDate(Date aDate, Selection aSelection) {</p>
    <p class="calibre_2">TimeZone tz =</p>
    <p class="calibre_2">aSelection.getRecorder().getLocation().getTimeZone(); </p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">But now the plotting routine is unnecessarily coupled to <span class="italic">three</span> classesâ€” Selection, </p>
    <p class="calibre_2">Recorder, and Location. This style of coding dramatically increases the number of classes </p>
    <p class="calibre_2">on which our class depends. Why is this a bad thing? It increases the risk that an unrelated </p>
    <p class="calibre_2">change somewhere else in the system will affect <span class="italic">your</span> code. For instance, if Fred makes a </p>
    <p class="calibre_2">change to Location such that it no longer directly contains a TimeZone, you have to change </p>
    <p class="calibre_2">your code as well. </p>
    <p class="calibre_2">Rather than digging though a hierarchy yourself, just ask for what you need directly:</p>
    <p class="calibre_2"><span class="bold">public void</span> plotDate(Date aDate, TimeZone aTz) {</p>
    <p class="calibre_2">... </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">plotDate(someDate, someSelection.getTimeZone()); </p>
    <p class="calibre_2">We added a method to Selection to get the time zone on our behalf: the plotting routine </p>
    <p class="calibre_2">doesn't care whether the time zone comes from the Recorder directly, from some </p>
    <p class="calibre_2">contained object within Recorder, or whether Selection makes up a different time zone </p>
    <p class="calibre_2">entirely. The selection routine, in turn, should probably just ask the recorder for its time </p>
    <p class="calibre_2">zone, leaving it up to the recorder to get it from its contained Location object. </p>
    <p class="calibre_2">Traversing relationships between objects directly can quickly lead to a combinatorial </p>
    <p class="calibre_2">explosion<a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[1]</span></span></a> of dependency relationships. You can see symptoms of this phenomenon in a</p>
    <p class="calibre_2">number of ways:</p>
    <p class="calibre_2">[1] If <span class="italic">n</span> objects all know about each other, then a change to just one object can result in the other <span class="italic">n</span> - <span class="bold">1</span></p>
    <p class="calibre_2">objects needing changes. </p>
    <p class="calibre_2">1. </p>
    <p class="calibre_2">Large C or C++ projects where the command to link a unit test is longer than the </p>
    <p class="calibre_2">
      <img class="calibre_24" src="images/00111.jpg"/>
    </p>
    <p class="calibre_2">test program itself</p>
    <p class="calibre_2">2. "Simple" changes to one module that propagate through unrelated modules in the </p>
    <p class="calibre_2">system</p>
    <p class="calibre_2">3. Developers who are afraid to change code because they aren't sure what might be </p>
    <p class="calibre_2">affected</p>
    <p class="calibre_2">Systems with many unnecessary dependencies are very hard (and expensive) to maintain, </p>
    <p class="calibre_2">and tend to be highly unstable. In order to keep the dependencies to a minimum, we'll use </p>
    <p class="calibre_2">the <span class="italic">Law of Demeter</span> to design our methods and functions. </p>
    <p class="calibre_2">
      <span class="bold">The Law of Demeter for Functions</span>
    </p>
    <p class="calibre_2">
      <span class="calibre_5">
        <span class="underline">The Law of Demeter for functions [LH89] attempts to minimize coupling between modules </span>
      </span>
    </p>
    <p class="calibre_2">in any given program. It tries to prevent you from reaching into an object to gain access to </p>
    <p class="calibre_2">a third object's methods. The law is summarized in <a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">Figure 5.1</span></span></a> on the next page. </p>
    <p class="calibre_2">
      <span class="bold">Figure 5.1. Law of Demeter for functions</span>
    </p>
    <p class="calibre_2">By writing "shy" code that honors the Law of Demeter as much as possible, we can achieve </p>
    <p class="calibre_2">our objective:</p>
    <p class="calibre_2">
      <span class="bold">Tip 36</span>
    </p>
    <p class="calibre_2">Minimize Coupling Between Modules</p>
    <p class="calibre_2">
      <span class="bold">Does It Really Make a Difference? </span>
    </p>
    <p class="calibre_2">While it sounds good in theory, does following the Law of Demeter really help to create </p>
    <p class="calibre_2">more maintainable code? </p>
    <p class="calibre_2"><span class="calibre_5"><span class="underline">Studies have shown [BBM96] that classes in C++ with larger </span></span>&#13;
<span class="italic">response sets</span> are more </p>
    <p class="calibre_2">prone to error than classes with smaller response sets (a <span class="italic">response set</span> is defined to be the </p>
    <p class="calibre_2">number of functions directly invoked by methods of the class). </p>
    <p class="calibre_2">Because following the Law of Demeter reduces the size of the response set in the calling </p>
    <p class="calibre_2">class, it follows that classes designed in this way will also tend to have fewer errors (see </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">[URL 56</span></span></a>] for more papers and information on the Demeter project). </p>
    <p class="calibre_2">Using The Law of Demeter will make your code more adaptable and robust, but at a cost:</p>
    <p class="calibre_2">as a "general contractor," your module must delegate and manage any and all</p>
    <p class="calibre_2">subcontractors directly, without involving clients of your module. In practice, this means</p>
    <p class="calibre_2">that you will be writing a large number of wrapper methods that simply forward the request</p>
    <p class="calibre_2">on to a delegate. These wrapper methods will impose both a runtime cost and a space</p>
    <p class="calibre_2">overhead, which may be significantâ€”even prohibitiveâ€”in some applications. </p>
    <p class="calibre_2">As with any technique, you must balance the pros and cons for <span class="italic">your</span> particular application. </p>
    <p class="calibre_2">In database schema design it is common practice to "denormalize" the schema for a </p>
    <p class="calibre_2">performance improvement: to violate the rules of normalization in exchange for speed. A </p>
    <p class="calibre_2">similar tradeoff can be made here as well. In fact, by reversing the Law of Demeter and </p>
    <p class="calibre_2"><span class="italic">tightly</span> coupling several modules, you may realize an important performance gain. As long </p>
    <p class="calibre_2">as it is well known and acceptable for those modules to be coupled, your design is fine. </p>
    <p class="calibre_2">
      <span class="bold">Physical Decoupling</span>
    </p>
    <p class="calibre_2">In this section we're concerned largely with designing to keep things logically </p>
    <p class="calibre_2">decoupled within systems. However, there is another kind of interdependence </p>
    <p class="calibre_2">that becomes highly significant as systems grow larger.In his book <span class="italic">Large-scale </span></p>
    <p class="calibre_2"><span class="italic">C++ software Design</span><span class="calibre_5"><span class="underline"> [Lak96</span></span>], John Lakos addresses the issues surrounding </p>
    <p class="calibre_2">the relationships among the files, directories, and libraries that make up a </p>
    <p class="calibre_2">system. Large projects that ignore these <span class="italic">physical design</span> problems wind up with</p>
    <p class="calibre_2">build cycles that are measured in days and unit tests that may drag in the entire</p>
    <p class="calibre_2">system as support code, among other problems. Mr. Lakos argues convincingly</p>
    <p class="calibre_2">that logical and physical design must proceed in tandemâ€”that undoing the</p>
    <p class="calibre_2">damage done to a large body of code by cyclic dependencies is extremely</p>
    <p class="calibre_2">difficult. We recommend this book if you are involved in large-scale</p>
    <p class="calibre_2">developments, even if C++ isn't your implementation language. </p>
    <p class="calibre_2">Otherwise, you may find yourself on the road to a brittle, inflexible future. Or no future at all. </p>
    <p class="calibre_2">
      <span class="bold">Related sections include:</span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Orthogonality</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Reversibility</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Design by Contract</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">How to Balance Resources</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">It's Just a View</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Pragmatic Teams</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">Ruthless Testing</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Challenges</span>
    </p>
    <p class="calibre_2">We've discussed how using delegation makes it easier to obey the Law of Demeter </p>
    <p class="calibre_2">and hence reduce coupling. However, writing all of the methods needed to forward </p>
    <p class="calibre_2">calls to delegated classes is boring and error prone. What are the advantages and </p>
    <p class="calibre_2">disadvantages of writing a preprocessor that generates these calls automatically? </p>
    <p class="calibre_2">Should this preprocessor be run only once, or should it be used as part of the </p>
    <p class="calibre_2">build? </p>
    <p class="calibre_2">
      <span class="bold">Exercises</span>
    </p>
    <p class="calibre_2">
      <span class="bold">24. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">We discussed the concept of physical decoupling in the box on on the facing </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">page. Which of the following C++ header flies is more tightly coupled to the </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">rest of the system? </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="italic">
        <span class="bold">person1.h</span>
      </span>
    </p>
    <p class="calibre_2">
      <span class="italic">
        <span class="bold">person2.h:</span>
      </span>
    </p>
    <p class="calibre_2"><span class="bold">#include</span>&#13;
<span class="italic">"date.h" </span></p>
    <p class="calibre_2"><span class="bold">class</span> Date; </p>
    <p class="calibre_2"><span class="bold">class</span> Person1 {</p>
    <p class="calibre_2"><span class="bold">class</span> Person2 {</p>
    <p class="calibre_2">
      <span class="bold">private:</span>
    </p>
    <p class="calibre_2">
      <span class="bold">private:</span>
    </p>
    <p class="calibre_2">Date myBirthdate; </p>
    <p class="calibre_2">Date *myBirthdate; </p>
    <p class="calibre_2">
      <span class="bold">public:</span>
    </p>
    <p class="calibre_2">
      <span class="bold">public:</span>
    </p>
    <p class="calibre_2">Person1(Date &amp;birthDate); </p>
    <p class="calibre_2">Person2(Date &amp;birthDate); </p>
    <p class="calibre_2">// ... </p>
    <p class="calibre_2">// ... </p>
    <p class="calibre_2">
      <span class="bold">25. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">For the example below and for those in Exercises 26 and 27, determine if the </span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">method calls shown are allowed according to the Law of Demeter. This first </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">one is in Java</span></span></a>. </p>
    <p class="calibre_2"><span class="bold">public void</span> showBalance(BankAccount acct) {</p>
    <p class="calibre_2">Money amt = acct.getBalance(); </p>
    <p class="calibre_2">printToScreen(amt.printFormat()); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">
      <span class="bold">26. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">This example is also in Java. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><span class="bold">public class</span> Colada {</p>
    <p class="calibre_2"><span class="bold">private</span> Blender myBlender; </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00133.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00200.jpg"/>
    </p>
    <p class="calibre_2"><span class="bold">private</span> Vector myStuff; </p>
    <p class="calibre_2"><span class="bold">public</span> Colada() {</p>
    <p class="calibre_2">myBlender = <span class="bold">new</span> Blender(); </p>
    <p class="calibre_2">myStuff = <span class="bold">new</span> Vector(); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2"><span class="bold">private void</span> doSomething() {</p>
    <p class="calibre_2">myBlender.addIngredients(myStuff.elements()); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">
      <span class="bold">27. </span>
    </p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">This example is in C++. </span>
        </span>
      </a>
    </p>
    <p class="calibre_2"><span class="bold">void</span> processTransaction(BankAccount acct, <span class="bold">int</span>) {</p>
    <p class="calibre_2">Person *who; </p>
    <p class="calibre_2">Money amt; </p>
    <p class="calibre_2">amt.setValue(123.45); </p>
    <p class="calibre_2">acct.setBalance(amt); </p>
    <p class="calibre_2">who = acct.getOwner(); </p>
    <p class="calibre_2">markWorkflow(who-&gt;name(), SET_BALANCE); </p>
    <p class="calibre_2">}</p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <img class="calibre_6" src="images/00174.jpg"/>
    </p>
    <p class="calibre_2">
      <img class="calibre_1" src="images/00182.jpg"/>
    </p>
    <p class="calibre_2">I l@ve RuBoard</p>
    <p class="calibre_2">
      <a href="index_split_000.html#filepos109">
        <span class="calibre_5">
          <span class="underline">&#13;
</span>
        </span>
      </a>
    </p>
    <p class="calibre_2">
      <span class="bold">Metaprogramming</span>
    </p>
    <p class="calibre_2">
      <span class="italic">No amount of genius can overcome a preoccupation with detail</span>
    </p>
    <p class="calibre_2">
      <span class="bold">Levy's Eighth Law</span>
    </p>
    <p class="calibre_2">Details mess up our pristine codeâ€”especially if they change frequently. Every time we</p>
    <p class="calibre_2">have to go in and change the code to accommodate some change in business logic, or in</p>
    <p class="calibre_2">the law, or in management's personal tastes of the day, we run the risk of breaking the</p>
    <p class="calibre_2">systemâ€”of introducing a new bug. </p>
    <p class="calibre_2">So we say "out with the details!" Get them out of the code. While we're at it, we can make</p>
    <p class="calibre_2">our code highly configurable and "soft"â€”that is, easily adaptable to changes. </p>
    <p class="calibre_2">
      <span class="bold">Dynamic Configuration</span>
    </p>
    <p class="calibre_2">First, we want to make our systems highly configurable. Not just things such as screen </p>
    <p class="calibre_2">colors and prompt text, but deeply ingrained items such as the choice of algorithms, </p>
    <p class="calibre_2">database products, middleware technology, and user-interface style. These items should </p>
    <p class="calibre_2">be implemented as configuration options, not through integration or engineering. </p>
    <p class="calibre_2">
      <span class="bold">Tip 37</span>
    </p>
    <p class="calibre_2">Configure, Don't Integrate</p>
    <p class="calibre_2">Use <span class="italic">metadata</span> to describe configuration options for an application: tuning parameters, user </p>
    <p class="calibre_2">preferences, the installation directory, and so on. </p>
    <p class="calibre_2">What exactly is metadata? Strictly speaking, metadata is data about data. The most </p>
    <p class="calibre_2">common example is probably a database schema or data dictionary. A schema contains </p>
    <p class="calibre_2">data that describes fields (columns) in terms of names, storage lengths, and other </p>
    <p class="calibre_2">attributes. You should be able to access and manipulate this information just as you would </p>
    <p class="calibre_2">any other data in the database. </p>
    <p class="calibre_2">We use the term in its broadest sense. Metadata is any data that describes the</p>
    <p class="calibre_2">applicationâ€”how it should run, what resources it should use, and so on. Typically, </p>
    <p class="calibre_2">metadata is accessed and used at runtime, not at compile time. You use metadata all the</p>
    <p class="calibre_2">timeâ€”at least your programs do. Suppose you click on an option to hide the toolbar on</p>
    <p class="calibre_2">your Web browser. The browser will store that preference, as metadata, in some sort of</p>
    <p class="calibre_2">internal database. </p>
    <p class="calibre_2">This database might be in a proprietary format, or it might use a standard mechanism. </p>
    <p class="calibre_2">Under Windows, either an initialization file (using the suffix .ini) or entries in the system </p>
    <p class="calibre_2">Registry are typical. Under Unix, the X Window System provides similar functionality using </p>
    <p class="calibre_2">Application Default files. Java uses Property files. In all of these environments, you specify </p>
    <p class="calibre_2">a key to retrieve a value. Alternatively, more powerful and flexible implementations of </p>
    <p class="calibre_2"><a href="index_split_000.html#filepos109"><span class="calibre_5"><span class="underline">metadata use an embedded scripting language (see Domain Languages</span></span></a>, for details). </p>
  </body>
</html>
